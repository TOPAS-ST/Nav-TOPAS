OBJECT Form 50023 Kalkulationsblatt
{
  OBJECT-PROPERTIES
  {
    Date=19.01.17;
    Time=11:12:35;
    Modified=Yes;
    Version List=TOPAS;
  }
  PROPERTIES
  {
    Width=13750;
    Height=11440;
    InsertAllowed=No;
    TableBoxID=1140000;
    SourceTable=Table50027;
    SourceTableView=SORTING(Art,Nr.,Zeilennr.,Gruppierung);
    OnOpenForm=BEGIN
                 CurrForm.btn_auswahl_sn.VISIBLE := FALSE;
                 CurrForm.txtbox_kalk_prozentsatz.VISIBLE := FALSE;
                 CurrForm.label_hinweis_kalk_prozentsatz.VISIBLE := FALSE;
                 AktFormTemplate;
               END;

    OnAfterGetRecord=BEGIN
                       diff := TOPAS_API.CalculateTimeDiff('M',Startdatum,Ablaufdatum);
                       laufzeit_text := TOPAS_API.RuntimeText_output(Startdatum,Ablaufdatum);
                     END;

    OnAfterGetCurrRecord=BEGIN
                           IF "Nachtr„gliche Service Order" = TRUE THEN
                             CurrForm.btn_auswahl_sn.VISIBLE := TRUE
                           ELSE
                             CurrForm.btn_auswahl_sn.VISIBLE := FALSE;

                           IF Fremderwerb = TRUE THEN
                             CurrForm."Ger„te Artikelnr.".EDITABLE := TRUE
                           ELSE
                             CurrForm."Ger„te Artikelnr.".EDITABLE := FALSE;

                           IF Artikel.GET("SUP Artikelnr.") AND ((Artikel.Artikelgruppe = 'ACTS')
                           OR (Artikel.Artikelgruppe = 'ACTS/ACHAT') OR (Artikel.Artikelgruppe = 'ACHAT')
                           OR (Artikel.Artikelgruppe = 'ACTS_SCHAEFFLER') OR (Artikel.Artikelgruppe = 'ACTS_MSS')
                           OR (Artikel.Artikelgruppe = 'ACTS_MSS_SCHAEFFLER') OR (Artikel.Artikelgruppe = 'APSS_OB')
                           OR (Artikel.Artikelgruppe = 'CHAMPS_PARTNER') OR (Artikel.Artikelgruppe = 'CHAMPS_FEE')) THEN
                             BEGIN
                               CurrForm.txtbox_kalk_prozentsatz.VISIBLE := TRUE;
                               CurrForm.label_hinweis_kalk_prozentsatz.VISIBLE := TRUE;
                             END
                           ELSE
                             BEGIN
                               CurrForm.txtbox_kalk_prozentsatz.VISIBLE := FALSE;
                               CurrForm.label_hinweis_kalk_prozentsatz.VISIBLE := FALSE;
                             END;

                           KalkFehlerPrfen;
                         END;

    OnModifyRecord=BEGIN
                     AusfhrungPrfen;
                   END;

  }
  CONTROLS
  {
    { 1140059;CommandButton;2750;1210;3300;700  ;Name=btn_demo_vorlage;
                                                 CaptionML=DEU=Demo Vorlage;
                                                 OnPush=BEGIN
                                                          DemoVorlage;
                                                        END;
                                                         }
    { 1140060;CommandButton;220;1210;2200 ;700  ;Name=btn_neue_pos;
                                                 CaptionML=DEU=Neue Pos.;
                                                 OnPush=BEGIN
                                                          NeueDemoPos;
                                                        END;
                                                         }
    { 1140000;TableBox  ;220  ;5170 ;13420;5500 ;HorzGlue=Both;
                                                 VertGlue=Both }
    { 1140001;TextBox   ;0    ;0    ;2100 ;0    ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Nr." }
    { 1140002;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140001;
                                                 InColumnHeading=Yes }
    { 1140003;TextBox   ;0    ;0    ;1700 ;0    ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Zeilennr." }
    { 1140004;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140003;
                                                 InColumnHeading=Yes }
    { 1140028;TextBox   ;5382 ;2530 ;4000 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="SUP Artikelnr." }
    { 1140029;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140028;
                                                 InColumnHeading=Yes }
    { 1140016;TextBox   ;3974 ;1870 ;4000 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Ger„te Artikelnr.";
                                                 OnFormat=BEGIN
                                                            IF Artikel.GET("Ger„te Artikelnr.") THEN
                                                              BEGIN
                                                                IF (Artikel.Blocked = TRUE) THEN
                                                                  CurrForm."Ger„te Artikelnr.".UPDATEFORECOLOR := 255;
                                                              END
                                                            ELSE
                                                              CurrForm."Ger„te Artikelnr.".UPDATEFORECOLOR := 255;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 1140017;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140016;
                                                 InColumnHeading=Yes }
    { 1140055;TextBox   ;10950;4510 ;2100 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Abw. Ger„te Artikelnr." }
    { 1140056;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140055;
                                                 InColumnHeading=Yes }
    { 1140039;TextBox   ;11292;4840 ;2200 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="MSRP Service" }
    { 1140040;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140039;
                                                 InColumnHeading=Yes }
    { 1140052;TextBox   ;13419;5170 ;1700 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Vertragsnr. bernommen" }
    { 1140053;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140052;
                                                 InColumnHeading=Yes }
    { 1140067;TextBox   ;23072;5280 ;2000 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Rabatt/Marge" }
    { 1140068;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140067;
                                                 InColumnHeading=Yes }
    { 1140073;TextBox   ;4736 ;5940 ;1700 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Quotenr." }
    { 1140074;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140073;
                                                 InColumnHeading=Yes }
    { 1140007;TextBox   ;0    ;0    ;2100 ;0    ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Belegnr.";
                                                 OnValidate=BEGIN
                                                              IF Fremderwerb = FALSE THEN
                                                                ERROR(Text011);
                                                            END;
                                                             }
    { 1140008;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140007;
                                                 InColumnHeading=Yes }
    { 1140009;TextBox   ;0    ;0    ;1693 ;0    ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Belegzeilennr.";
                                                 OnValidate=BEGIN
                                                              IF Fremderwerb = FALSE THEN
                                                                ERROR(Text011);
                                                            END;
                                                             }
    { 1140010;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140009;
                                                 InColumnHeading=Yes }
    { 1140069;CheckBox  ;24448;5280 ;1800 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 ShowCaption=No;
                                                 SourceExpr="Laufzeit ab Buchungsdatum";
                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.SAVERECORD;
                                                                   IF UpdateLaufzeitabBuchungsdatum(Rec) = TRUE THEN
                                                                     BEGIN
                                                                       CurrForm.UPDATE(TRUE);
                                                                     END;
                                                                 END;
                                                                  }
    { 1140070;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140069;
                                                 InColumnHeading=Yes }
    { 1140077;CheckBox  ;26591;6270 ;1800 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 ShowCaption=No;
                                                 SourceExpr="Beachte Startdatum";
                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.SAVERECORD;
                                                                   IF UpdateBeachteStartdatum(Rec) = TRUE THEN
                                                                     BEGIN
                                                                       CurrForm.UPDATE(TRUE);
                                                                     END;
                                                                 END;
                                                                  }
    { 1140078;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140077;
                                                 InColumnHeading=Yes }
    { 1140030;TextBox   ;1056 ;2200 ;1500 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr=Laufzeit;
                                                 OnValidate=BEGIN
                                                              //IF STRPOS("SUP Artikelnr.",'CHAMPS') = 0 THEN
                                                              //  ERROR(Text009);
                                                            END;
                                                             }
    { 1140031;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140030;
                                                 InColumnHeading=Yes }
    { 1140075;TextBox   ;27676;5610 ;2000 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 CaptionML=DEU=Laufzeit Text;
                                                 SourceExpr=laufzeit_text }
    { 1140076;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140075;
                                                 InColumnHeading=Yes }
    { 1140018;TextBox   ;14813;2200 ;1700 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr=Startdatum }
    { 1140019;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140018;
                                                 InColumnHeading=Yes }
    { 1140020;TextBox   ;16513;2200 ;1700 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr=Ablaufdatum;
                                                 OnFormat=BEGIN
                                                            IF FORMAT(diff) <> DELCHR(Laufzeit,'=','M') THEN
                                                              CurrForm.Ablaufdatum.UPDATEFORECOLOR := 255
                                                            ELSE
                                                              CurrForm.Ablaufdatum.UPDATEFORECOLOR := 0;
                                                          END;
                                                           }
    { 1140021;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140020;
                                                 InColumnHeading=Yes }
    { 1140026;TextBox   ;15316;2420 ;1700 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 FontBold=Yes;
                                                 DecimalPlaces=0:0;
                                                 SourceExpr="Menge kalk.";
                                                 OnValidate=BEGIN
                                                              MengeKalkPrfen;
                                                            END;
                                                             }
    { 1140027;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140026;
                                                 InColumnHeading=Yes;
                                                 FontBold=No }
    { 1140022;TextBox   ;15265;1980 ;2500 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 FontBold=Yes;
                                                 SourceExpr="Service VK-Preis einzeln" }
    { 1140023;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140022;
                                                 InColumnHeading=Yes;
                                                 FontBold=No }
    { 1140024;TextBox   ;17504;2530 ;2500 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 FontBold=No;
                                                 SourceExpr="Service VK-Preis Zeilenbetrag" }
    { 1140025;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140024;
                                                 InColumnHeading=Yes;
                                                 FontBold=No }
    { 1140035;TextBox   ;26029;5390 ;2200 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Service DC einzeln" }
    { 1140036;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140035;
                                                 InColumnHeading=Yes }
    { 1140037;TextBox   ;28229;5390 ;2200 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Service DC Gesamt" }
    { 1140038;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140037;
                                                 InColumnHeading=Yes }
    { 1140057;TextBox   ;37932;5170 ;2308 ;440  ;Editable=No;
                                                 ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Service DC W„hrungscode" }
    { 1140058;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140057;
                                                 InColumnHeading=Yes }
    { 1140045;TextBox   ;17353;3850 ;2100 ;440  ;ParentControl=1140000;
                                                 InColumn=Yes;
                                                 SourceExpr="Wartungsvertragsnr.";
                                                 OnValidate=BEGIN
                                                              //***************************************************************************************************
                                                              //         Der Wartungsvertrag muss bei nachtr„glicher Zubuchung neuer Pos. noch gltig sein
                                                              //***************************************************************************************************

                                                              IF "Wartungsvertragsnr." <> '' THEN
                                                                BEGIN

                                                                  Wartungsvertrag.GET("Wartungsvertragsnr.");
                                                                  IF ((Wartungsvertrag.Status = Wartungsvertrag.Status :: Auftrag)
                                                                  OR (Wartungsvertrag.Status = Wartungsvertrag.Status :: ACTS)
                                                                  OR (Wartungsvertrag.Status = Wartungsvertrag.Status :: ACHAT)
                                                                  OR (Wartungsvertrag.Status = Wartungsvertrag.Status :: "Champs Partner")) THEN
                                                                    BEGIN
                                                                      IF (Wartungsvertrag.Vertragsablaufdatum < WORKDATE) THEN
                                                                        ERROR(Text014,Wartungsvertrag."Wartungsvertragsnr.");
                                                                    END
                                                                  ELSE
                                                                    ERROR(Text015,Wartungsvertrag."Wartungsvertragsnr.");

                                                                  IF Ablaufdatum = 0D THEN
                                                                    BEGIN
                                                                       v_ablaufdatum := Ablaufdatum_generieren("SUP Artikelnr.","Wartungsvertragsnr.");
                                                                      IF v_ablaufdatum <> 0D THEN
                                                                        BEGIN
                                                                          VALIDATE(Laufzeit,FORMAT(TOPAS_API.CalculateTimeDiff('M',WORKDATE,v_ablaufdatum)) + 'M');
                                                                          MESSAGE(Text020,Laufzeit);
                                                                        END;
                                                                    END;

                                                                END;

                                                              //Bei Basisger„ten nicht gestattet, sonst wird evtl. nicht das Vertragsablaufdatum im Vertragskopf ge„ndert

                                                              IF Basisger„t =  TRUE THEN
                                                                TESTFIELD("Wartungsvertragsnr.",'');
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 1140046;Label     ;0    ;0    ;0    ;0    ;ParentControl=1140045;
                                                 InColumnHeading=Yes }
    { 1140011;CommandButton;6600;10780;2200;550 ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Default=Yes;
                                                 PushAction=LookupOK;
                                                 InvalidActionAppearance=Hide }
    { 1140012;CommandButton;9020;10780;2200;550 ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Cancel=Yes;
                                                 PushAction=LookupCancel;
                                                 InvalidActionAppearance=Hide }
    { 1140013;CommandButton;11440;10780;2200;550;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 1140014;CommandButton;220;1210;2200 ;700  ;Name=btn_alle_pos_holen;
                                                 CaptionML=DEU=Alle Pos. holen;
                                                 OnPush=BEGIN
                                                          AusfhrungPrfen;
                                                          HoleArtikelPos;
                                                        END;
                                                         }
    { 1140015;CommandButton;2750;1210;3300;700  ;Name=btn_preise_berechnen;
                                                 CaptionML=DEU=Kalkulieren;
                                                 OnPush=BEGIN
                                                          AusfhrungPrfen;
                                                          PreiseKalkulieren;
                                                        END;
                                                         }
    { 1140005;Label     ;220  ;330  ;11770;550  ;FontSize=12;
                                                 FontBold=Yes;
                                                 CaptionML=DEU=Kalkulationsblatt }
    { 1140006;CommandButton;6380;1210;2700;700  ;Name=btn_auswahl_sn;
                                                 CaptionML=DEU=Auswahl Seriennr.;
                                                 OnPush=BEGIN
                                                          AusfhrungPrfen;
                                                          TempSeriennrhinzu;
                                                        END;
                                                         }
    { 1140033;TextBox   ;220  ;4510 ;13420;440  ;Name=label_hinweistext;
                                                 Editable=No;
                                                 Focusable=No;
                                                 Border=No;
                                                 SourceExpr=hinweistext;
                                                 OnFormat=BEGIN
                                                            IF hinweistext <> '' THEN
                                                              BEGIN
                                                                CurrForm.label_hinweistext.UPDATEFONTBOLD := TRUE;
                                                                CurrForm.label_hinweistext.UPDATEFORECOLOR := 255;
                                                              END
                                                            ELSE
                                                              BEGIN
                                                                CurrForm.label_hinweistext.UPDATEFONTBOLD := FALSE;
                                                                CurrForm.label_hinweistext.UPDATEFORECOLOR := 0;
                                                              END;
                                                          END;
                                                           }
    { 1140041;MenuButton;9350 ;1210 ;2750 ;660  ;Name=btn_extra_funktionen;
                                                 CaptionML=DEU=Extra Funktionen;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1140032;
                                                     CaptionML=DEU=Logische Positionsbernahme;
                                                     OnPush=BEGIN
                                                              AusfhrungPrfen;
                                                              Logikšbernahme;
                                                            END;
                                                             }
                                                   { ID=1140054;
                                                     CaptionML=DEU=Vorg„ngerkalkulation kopieren;
                                                     OnPush=BEGIN
                                                              AusfhrungPrfen;
                                                              Vorg„ngerKopieren;
                                                            END;
                                                             }
                                                   { ID=1140034;
                                                     MenuItemType=Separator }
                                                   { ID=1140042;
                                                     CaptionML=DEU=Alles l”schen;
                                                     OnPush=BEGIN
                                                              AusfhrungPrfen;
                                                              L”schAllePos;
                                                            END;
                                                             }
                                                   { ID=1140043;
                                                     MenuItemType=Separator }
                                                   { ID=1140044;
                                                     CaptionML=DEU=Fremderwerb;
                                                     OnPush=BEGIN
                                                              AusfhrungPrfen;
                                                              AnlageFremderwerbsPos;
                                                            END;
                                                             }
                                                   { ID=1140063;
                                                     Visible=No;
                                                     MenuItemType=Separator }
                                                   { ID=1140064;
                                                     Visible=No;
                                                     CaptionML=DEU=TEMP_Alle Pos. holen;
                                                     OnPush=BEGIN
                                                              HoleArtikelPos_TEMP;
                                                            END;
                                                             }
                                                   { ID=1140065;
                                                     Visible=No;
                                                     CaptionML=DEU=TEMP_Auswahl Seriennr.;
                                                     OnPush=BEGIN
                                                              TempSeriennrhinzu_TEMP;
                                                            END;
                                                             }
                                                   { ID=1140066;
                                                     Visible=No;
                                                     CaptionML=DEU=TEMP_Fremderwerb;
                                                     OnPush=BEGIN
                                                              AnlageFremderwerb_TEMP;
                                                            END;
                                                             }
                                                 }
                                                  }
    { 1140047;TextBox   ;220  ;2200 ;2200 ;440  ;Name=txtbox_lieferscheinnr;
                                                 SourceExpr=lieferscheinnr;
                                                 TableRelation="Sales Shipment Header" }
    { 1140048;Label     ;2750 ;2200 ;10890;440  ;Name=label_hinweis_lieferschein;
                                                 CaptionML=DEU=Lieferscheinnr. angeben, fr Auftragspositionen leer lassen }
    { 1140049;TextBox   ;220  ;2750 ;2200 ;440  ;Name=txtbox_vertragsnr;
                                                 SourceExpr=wartungsnr;
                                                 TableRelation=Wartungsvertrag }
    { 1140050;Label     ;2750 ;2750 ;10890;440  ;Name=label_hinweis_vertr„ge;
                                                 ForeColor=16744760;
                                                 CaptionML=DEU=Fr Vertragsverl„ngerungen die Vertragsnr. eingeben }
    { 1140051;CommandButton;12210;1210;1430;660 ;Name=btn_exportto_excel;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 Bitmap=1478;
                                                 ToolTipML=DEU=Kundeninformationen zur Vertragsverl„ngerung nach Excel exportieren;
                                                 OnPush=BEGIN
                                                          InfosExcelExport;
                                                        END;
                                                         }
    { 1140061;Label     ;2750 ;3300 ;10890;440  ;Name=label_hinweis_kalk_prozentsatz;
                                                 CaptionML=DEU="Fr ACTS + CHAMPS Partner = Rabatt, fr ACHAT = Marge eingeben." }
    { 1140062;TextBox   ;220  ;3300 ;2200 ;440  ;Name=txtbox_kalk_prozentsatz;
                                                 SourceExpr=kalk_prozentsatz;
                                                 OnValidate=BEGIN
                                                              Artikel.GET("SUP Artikelnr.");

                                                              IF (kalk_prozentsatz > 20) AND (Artikel.Artikelgruppe = 'APSS_OB') THEN
                                                                ERROR(Text017,20);

                                                              IF (kalk_prozentsatz > 10) AND (Artikel.Artikelgruppe = 'ACTS') THEN
                                                                ERROR(Text017,10);

                                                              IF (kalk_prozentsatz > 5) AND (Artikel.Artikelgruppe = 'ACTS_MSS') THEN
                                                                ERROR(Text017,5);

                                                              IF (kalk_prozentsatz < 20) AND (Artikel.Artikelgruppe = 'CHAMPS_PARTNER') THEN
                                                                ERROR(Text021,20);

                                                              IF (kalk_prozentsatz <> 0) AND (kalk_prozentsatz <> 20) AND (Artikel.Artikelgruppe = 'CHAMPS_FEE') THEN
                                                                ERROR(Text023,Artikel.Artikelgruppe,20);
                                                            END;
                                                             }
    { 1140071;TextBox   ;220  ;3850 ;2200 ;440  ;SourceExpr=quotenr;
                                                 TableRelation=Quotedaten WHERE (Herstellercode=FILTER(57|5710|5720),
                                                                                 Erledigtstatus=FILTER(' ')) }
    { 1140072;Label     ;2750 ;3850 ;10890;440  ;CaptionML=DEU=Quotenr. angeben }
  }
  CODE
  {
    VAR
      SalesLine@1140000 : Record 37;
      SalesLine_Service@1140042 : Record 37;
      ShipLine@1140047 : Record 111;
      ServRelaDoc@1140045 : Record 50027;
      TempServRelaDoc@1140044 : Record 50027;
      CheckServRelaDoc@1140046 : Record 50027;
      Opt@1140052 : Record 50001;
      ServicePos@1140051 : Record 50024;
      SystemPos@1140043 : Record 50024;
      CompareSystemPos@1140050 : Record 50024;
      ShowSerialNo@1140001 : Record 50024;
      Artikel@1140027 : Record 27;

      Text000@1140002 : TextConst
        'DEU=Beleg konnte entweder nicht gefunden werden oder es handelt sich hierbei nicht um einen AudioCodes System Auftrag. Wenden Sie sich an Ihren Systemadministrator.';

      Text001@1140003 : TextConst
        'DEU=Die kalk. Menge fr ein Basisger„t darf nicht gr”áer als 1 sein. Identische Basisger„te mssen auch in der Kalkulation differenziert voneinander betrachtet werden.';

      Text002@1140004 : TextConst
        'DEU=Bitte hinterlegen Sie fr Artikelnr. %1 eine Serviceklassifizierung im Artikelstamm.';
      Wartungsvertrag@1140024 : Record 50011;
      TOPAS_API@1140033 : Codeunit 50001;
      Excel@1140022 : Automation "{00020813-0000-0000-C000-000000000046} 1.2:{00024500-0000-0000-C000-000000000046}:Unknown Automation Server.Application";
      Book@1140021 : Automation "{00020813-0000-0000-C000-000000000046} 1.2:{00020819-0000-0000-C000-000000000046}:Unknown Automation Server.Workbook";
      Range@1140020 : Automation "{00020813-0000-0000-C000-000000000046} 1.2:{00020846-0000-0000-C000-000000000046}:Unknown Automation Server.Range";
      Sheet@1140019 : Automation "{00020813-0000-0000-C000-000000000046} 1.2:{00020820-0000-0000-C000-000000000046}:Unknown Automation Server.Worksheet";
      j@1140018 : Text[30];
      lieferscheinnr@1140015 : Code[20];
      wartungsnr@1140016 : Code[20];
      kalk_prozentsatz@1140029 : Decimal;
      hinweistext@1140005 : Text[120];

      Text003@1140006 : TextConst
        'DEU=Es wurde bereits ein %1 Preis errechnet, m”chten Sie diesen im Beleg berschreiben?';

      Text004@1140007 : TextConst
        'DEU=Der %1 Preis betr„gt nun %2. Der Vk-Preis im Beleg wurde entsprechend aktualisiert.\Der %3 betr„gt %4.';

      Text005@1140008 : TextConst
        'DEU=Es konnte kein %1 Preis errechnet werden.';

      Text006@1140009 : TextConst
        'DEU=%1 darf in diesem Fall nicht gr”áer sein als %2.';

      Text007@1140010 : TextConst
        'DEU=Diese Kalkulation ist bereits archiviert. Žnderungen sind nicht mehr m”glich.';

      Text008@1140011 : TextConst
        'DEU=Diese Funktion kann nicht fr die nachtr„gliche Kalkulation genutzt werden. Nutzen Sie stattdessen die Standardfunktion zum šbernehmen der Positionen.';

      Text009@1140012 : TextConst
        'DEU=Die Laufzeitanpassung ist nur fr bestimmte Serviceartikel gestattet.';

      Text010@1140013 : TextConst
        'DEU=Es konnte kein Basisger„t in der Kalkulation gefunden werden. Sind Sie sich sicher, dass die Angaben vollst„ndig sind?';

      Text011@1140014 : TextConst
        'DEU=Žnderung nur bei Fremderwerb m”glich.';

      Text012@1140017 : TextConst
        'DEU=Sie k”nnen nicht gleichzeitig einen Lieferschein und einen Wartungsvertrag hinzufgen, bitte treffen Sie nur eine Auswahl.';

      Text013@1140023 : TextConst
        'DEU=Bitte fllen Sie zuerst die Wartungsvertragsnr. aus.';

      Text014@1140025 : TextConst
        'DEU=Der angegebene Wartungsvertrag %1 ist abgelaufen. Sie mssen den gesamten Wartungsvertrag verl„ngern, um diese Buchung durchfhren zu k”nnen.\\Hinweis: Sie k”nnen den Wartungsvertrag gleich mit verl„ngern, indem Sie die Pos. aus dem Wartungsvertrag mit in diese Kalkulation bernehmen.';

      Text015@1140026 : TextConst
        'DEU=Sie k”nnen hier kein Systemvertrag ausw„hlen, es muss sich um einen gltigen Wartungsvertrag handeln.';

      Text016@1140028 : TextConst
        'DEU=Sie drfen nicht verschiedene Basisger„te in einer Kalkulation aufweisen.';

      Text017@1140030 : TextConst
        'DEU=Der ACTS Rabatt darf den Wert von %1 nicht bersteigen.';

      Text018@1140031 : TextConst
        'DEU=Die %1 Marge sollte ber 50 Prozent liegen.';
      diff@1140032 : Integer;
      v_ablaufdatum@1140035 : Date;

      Text019@1140034 : TextConst
        'DEU=Sie k”nnen nicht einzelne Module verl„ngern.Žndern Sie die Kalkulation dahingehend, dass Sie Basisger„t und all seine Komponenten gleichzeitg verl„ngern.';

      Text020@1140036 : TextConst
        'DEU=Die Laufzeit wurde entsprechend des Wartungsvertrages auf %1 angepasst.';

      Text021@1140037 : TextConst
        'DEU=Der CHAMPS Partner Rabatt darf den Wert von %1 nicht unterschreiten.';

      Text022@1140038 : TextConst
        'DEU=Es empfiehlt sich nicht fremderworbene Basissysteme mit derselben Artikelnr. zu splitten. Bitte kumulieren Sie die Ger„te in einer Position und nutzen Sie die Mengen Angabe.';
      quotenr@1140039 : Code[20];

      Text023@1140040 : TextConst
        'DEU=Der %1 Rabatt darf nur den Wert %2 oder 0 annehmen.';
      laufzeit_text@1140041 : Text[30];
      menge_gesamt@1140049 : Decimal;
      zeilennr@1140048 : Integer;

    PROCEDURE HoleArtikelPos@1140007();
    BEGIN
      IF (lieferscheinnr <> '') AND (wartungsnr <> '') THEN
        ERROR(Text012);

      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));
          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN
              IF (lieferscheinnr = '') AND (wartungsnr = '') THEN
                BEGIN
                  SalesLine.RESET;
                  SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
                  SalesLine.SETFILTER("Manufacturer Code",'%1','59');
                  IF SalesLine.FINDFIRST THEN

                    ////Service bezieht sich auf Auftrag
                    BEGIN
                      REPEAT
                        Artikel.GET(SalesLine."No.");
                        IF Artikel."Software Upgrade Protection" = FALSE THEN
                          BEGIN
                            TempServRelaDoc.RESET;
                            TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                            TempServRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
                            TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                            TempServRelaDoc.SETFILTER("Belegnr.",'%1',SalesLine."Document No.");
                            TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',SalesLine."Line No.");
                            IF NOT TempServRelaDoc.FINDFIRST THEN
                              BEGIN
                                ServRelaDoc.INIT;
                                ServRelaDoc.Art := Art :: "SUP-AU";
                                ServRelaDoc."Nr." := SalesLine."Document No.";
                                ServRelaDoc."Zeilennr." := zeilennr;
                                ServRelaDoc."Belegnr." := SalesLine."Document No.";
                                ServRelaDoc."Belegzeilennr." := SalesLine."Line No.";
                                ServRelaDoc."Debitornr." := SalesLine."Sell-to Customer No.";
                                ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                ServRelaDoc.VALIDATE("Ger„te Artikelnr.",SalesLine."No.");
                                ServRelaDoc."Menge kalk." := SalesLine."Outstanding Quantity";
                                //Laufzeit vorbelegen
                                Opt.RESET;
                                Opt.SETFILTER("Tabellen ID",'%1',50024);
                                Opt.SETFILTER("Feld ID",'%1',44);
                                Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                IF Opt.FINDFIRST THEN
                                  ServRelaDoc.Laufzeit := Opt.Code;
                                ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                ServRelaDoc.INSERT(TRUE);
                              END;
                          END;
                      UNTIL SalesLine.NEXT = 0;
                      CurrForm.UPDATE;
                    END;
                END
              ELSE
                BEGIN
                  ////Service bezieht sich auf Lieferschein
                  IF (lieferscheinnr <> '') AND (lieferscheinnr <> GETFILTER("Nr.")) THEN
                    BEGIN
                      ShipLine.RESET;
                      ShipLine.SETFILTER("Document No.",'%1',lieferscheinnr);
                      ShipLine.SETFILTER("Manufacturer Code",'%1','59');
                      ShipLine.SETFILTER(Quantity,'>%1',0);
                      IF ShipLine.FINDFIRST THEN
                        BEGIN
                          REPEAT
                            Artikel.GET(ShipLine."No.");
                            IF Artikel."Software Upgrade Protection" = FALSE THEN
                              BEGIN
                                TempServRelaDoc.RESET;
                                TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                                TempServRelaDoc.SETFILTER("Nr.",'%1',GETFILTER("Nr."));
                                TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                                TempServRelaDoc.SETFILTER("Belegnr.",'%1',ShipLine."Document No.");
                                TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',ShipLine."Line No.");
                                IF NOT TempServRelaDoc.FINDFIRST THEN
                                  BEGIN
                                    ServRelaDoc.INIT;
                                    ServRelaDoc.Art := Art :: "SUP-AU";
                                    ServRelaDoc."Nr." := SalesLine_Service."Document No.";
                                    ServRelaDoc."Zeilennr." := zeilennr;
                                    ServRelaDoc."Belegnr." := ShipLine."Document No.";
                                    ServRelaDoc."Belegzeilennr." := ShipLine."Line No.";
                                    ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
                                    ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                    ServRelaDoc.VALIDATE("Ger„te Artikelnr.",ShipLine."No.");
                                    ServRelaDoc."Menge kalk." := ShipLine.Quantity;
                                    ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
                                    //Laufzeit vorbelegen
                                    Opt.RESET;
                                    Opt.SETFILTER("Tabellen ID",'%1',50024);
                                    Opt.SETFILTER("Feld ID",'%1',44);
                                    Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                    IF Opt.FINDFIRST THEN
                                      ServRelaDoc.Laufzeit := Opt.Code;
                                    ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                    ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                    ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                    ServRelaDoc.INSERT(TRUE);
                                  END;
                              END;
                          UNTIL ShipLine.NEXT = 0;
                          CurrForm.UPDATE;
                        END
                      ELSE
                        ERROR(Text000);
                    END
                  ELSE
                    BEGIN
                      ////Service bezieht sich auf einen Wartungsvertrag
                      IF (wartungsnr <> '') THEN
                        BEGIN
                          ServicePos.RESET;
                          ServicePos.SETFILTER(ServicePos.Art,'%1',ServicePos.Art :: Service);
                          ServicePos.SETFILTER(ServicePos."Wartungsvertragsnr.",'%1',wartungsnr);
                          //ServicePos.SETFILTER(Verl„ngerung,'%1',FALSE);
                          ServicePos.SETFILTER(Inaktiv,'%1',FALSE);
                          IF ServicePos.FINDFIRST THEN
                            BEGIN
                              REPEAT
                                CompareSystemPos.RESET;
                                CompareSystemPos.SETFILTER(Art,'%1',CompareSystemPos.Art :: System);
                                CompareSystemPos.SETFILTER(Inaktiv,'%1',FALSE);
                                CompareSystemPos.SETFILTER("Wartungsvertragsnr.",'%1',wartungsnr);
                                CompareSystemPos.SETFILTER("Nr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                CompareSystemPos.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                IF CompareSystemPos.FINDFIRST THEN
                                  BEGIN
                                    TempServRelaDoc.RESET;
                                    TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                                    TempServRelaDoc.SETFILTER("Nr.",'%1',GETFILTER("Nr."));
                                    TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                                    TempServRelaDoc.SETFILTER("Belegnr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                    TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                    IF NOT TempServRelaDoc.FINDFIRST THEN
                                      BEGIN
                                        ServRelaDoc.INIT;
                                        ServRelaDoc.Art := Art :: "SUP-AU";
                                        ServRelaDoc."Nr." := SalesLine_Service."Document No.";
                                        ServRelaDoc."Zeilennr." := zeilennr;
                                        ServRelaDoc."Belegnr." := ServicePos."Urspr. Lieferscheinnr.";
                                        ServRelaDoc."Belegzeilennr." := ServicePos."Urspr. Lieferscheinzeilennr.";
                                        ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
                                        ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                        ServRelaDoc.VALIDATE("Ger„te Artikelnr.",ServicePos."Artikelnr.");
                                        ServRelaDoc."Menge kalk." := ServicePos.Menge;
                                        ServRelaDoc."Vertragsnr. bernommen" := wartungsnr;
                                        ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
                                        ServRelaDoc.Fremderwerb := ServicePos.Fremderwerb;
                                        //Laufzeit vorbelegen
                                        Opt.RESET;
                                        Opt.SETFILTER("Tabellen ID",'%1',50024);
                                        Opt.SETFILTER("Feld ID",'%1',44);
                                        Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                        IF Opt.FINDFIRST THEN
                                          ServRelaDoc.Laufzeit := Opt.Code;
                                        ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                        ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                        ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                        ServRelaDoc.INSERT(TRUE);
                                      END
                                    ELSE
                                      BEGIN
                                        CompareSystemPos.RESET;
                                        CompareSystemPos.SETFILTER(Art,'%1',CompareSystemPos.Art :: System);
                                        CompareSystemPos.SETFILTER(Inaktiv,'%1',FALSE);
                                        CompareSystemPos.SETFILTER("Wartungsvertragsnr.",'%1',wartungsnr);
                                        CompareSystemPos.SETFILTER("Nr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                        CompareSystemPos.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                        IF CompareSystemPos.FINDFIRST THEN
                                          BEGIN
                                            menge_gesamt := 0;
                                            REPEAT
                                              menge_gesamt := menge_gesamt + CompareSystemPos.Menge;
                                            UNTIL CompareSystemPos.NEXT = 0;
                                            IF TempServRelaDoc."Menge kalk." < menge_gesamt THEN
                                              BEGIN
                                                TempServRelaDoc."Menge kalk." := TempServRelaDoc."Menge kalk." + ServicePos.Menge;
                                                TempServRelaDoc.MODIFY;
                                              END;
                                          END;
                                      END;
                                  END;
                              UNTIL ServicePos.NEXT = 0;
                              CurrForm.UPDATE;
                            END
                          ELSE
                            ERROR(Text000);
                        END
                      ELSE
                        ERROR(Text000);
                    END;
                END;
            END
          ELSE
            ERROR(Text000);
        END;
    END;

    PROCEDURE HoleArtikelPos_TEMP@1140014();
    BEGIN
      IF lieferscheinnr = '' THEN ERROR('TEMP Funktion nur mit Lieferscheinnr. ausfhrbar.');

      IF (lieferscheinnr <> '') AND (wartungsnr <> '') THEN
        ERROR(Text012);

      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));
          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN
              IF (lieferscheinnr = '') AND (wartungsnr = '') THEN
                BEGIN
                  SalesLine.RESET;
                  SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
                  SalesLine.SETFILTER("Manufacturer Code",'%1','59');
                  IF SalesLine.FINDFIRST THEN

                    ////Service bezieht sich auf Auftrag
                    BEGIN
                      REPEAT
                        Artikel.GET(SalesLine."No.");
                        IF Artikel."Software Upgrade Protection" = FALSE THEN
                          BEGIN
                            TempServRelaDoc.RESET;
                            TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                            TempServRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
                            TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                            TempServRelaDoc.SETFILTER("Belegnr.",'%1',SalesLine."Document No.");
                            TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',SalesLine."Line No.");
                            IF NOT TempServRelaDoc.FINDFIRST THEN
                              BEGIN
                                ServRelaDoc.INIT;
                                ServRelaDoc.Art := Art :: "SUP-AU";
                                ServRelaDoc."Nr." := SalesLine."Document No.";
                                ServRelaDoc."Zeilennr." := zeilennr;
                                ServRelaDoc."Belegnr." := SalesLine."Document No.";
                                ServRelaDoc."Belegzeilennr." := SalesLine."Line No.";
                                ServRelaDoc."Debitornr." := SalesLine."Sell-to Customer No.";
                                ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                ServRelaDoc.VALIDATE("Ger„te Artikelnr.",SalesLine."No.");
                                ServRelaDoc."Menge kalk." := SalesLine."Outstanding Quantity";
                                //Laufzeit vorbelegen
                                Opt.RESET;
                                Opt.SETFILTER("Tabellen ID",'%1',50024);
                                Opt.SETFILTER("Feld ID",'%1',44);
                                Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                IF Opt.FINDFIRST THEN
                                  ServRelaDoc.Laufzeit := Opt.Code;
                                ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                ServRelaDoc.INSERT(TRUE);
                              END;
                          END;
                      UNTIL SalesLine.NEXT = 0;
                      CurrForm.UPDATE;
                    END;
                END
              ELSE
                BEGIN
                  ////Service bezieht sich auf Lieferschein
                  IF (lieferscheinnr <> '') AND (lieferscheinnr <> GETFILTER("Nr.")) THEN
                    BEGIN
                      ShipLine.RESET;
                      ShipLine.SETFILTER("Document No.",'%1',lieferscheinnr);
                      ShipLine.SETFILTER("Manufacturer Code",'%1','59');
                      ShipLine.SETFILTER(Quantity,'>%1',0);
                      IF ShipLine.FINDFIRST THEN
                        BEGIN
                          REPEAT
                            Artikel.GET(ShipLine."No.");
                            IF Artikel."Software Upgrade Protection" = FALSE THEN
                              BEGIN
                                TempServRelaDoc.RESET;
                                TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                                TempServRelaDoc.SETFILTER("Nr.",'%1',GETFILTER("Nr."));
                                TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                                TempServRelaDoc.SETFILTER("Belegnr.",'%1',ShipLine."Document No.");
                                TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',ShipLine."Line No.");
                                IF NOT TempServRelaDoc.FINDFIRST THEN
                                  BEGIN
                                    ServRelaDoc.INIT;
                                    ServRelaDoc.Art := Art :: "SUP-AU";
                                    ServRelaDoc."Nr." := SalesLine_Service."Document No.";
                                    ServRelaDoc."Zeilennr." := zeilennr;
                                    ServRelaDoc."Belegnr." := ShipLine."Document No.";
                                    ServRelaDoc."Belegzeilennr." := ShipLine."Line No.";
                                    ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
                                    ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                    ServRelaDoc.VALIDATE("Ger„te Artikelnr.",ShipLine."No.");
                                    ServRelaDoc."Menge kalk." := ShipLine.Quantity;
                                    ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
                                    //Laufzeit vorbelegen
                                    Opt.RESET;
                                    Opt.SETFILTER("Tabellen ID",'%1',50024);
                                    Opt.SETFILTER("Feld ID",'%1',44);
                                    Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                    IF Opt.FINDFIRST THEN
                                      ServRelaDoc.Laufzeit := Opt.Code;
                                    ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                    ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                    ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                    ServRelaDoc.INSERT(TRUE);
                                  END;
                              END;
                          UNTIL ShipLine.NEXT = 0;
                          CurrForm.UPDATE;
                        END
                      ELSE
                        ERROR(Text000);
                    END
                  ELSE
                    BEGIN
                      ////Service bezieht sich auf einen Wartungsvertrag
                      IF (wartungsnr <> '') THEN
                        BEGIN
                          ServicePos.RESET;
                          ServicePos.SETFILTER(ServicePos.Art,'%1',ServicePos.Art :: Service);
                          ServicePos.SETFILTER(ServicePos."Wartungsvertragsnr.",'%1',wartungsnr);
                          //ServicePos.SETFILTER(Verl„ngerung,'%1',FALSE);
                          ServicePos.SETFILTER(Inaktiv,'%1',FALSE);
                          IF ServicePos.FINDFIRST THEN
                            BEGIN
                              REPEAT
                                CompareSystemPos.RESET;
                                CompareSystemPos.SETFILTER(Art,'%1',CompareSystemPos.Art :: System);
                                CompareSystemPos.SETFILTER(Inaktiv,'%1',FALSE);
                                CompareSystemPos.SETFILTER("Wartungsvertragsnr.",'%1',wartungsnr);
                                CompareSystemPos.SETFILTER("Nr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                CompareSystemPos.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                IF CompareSystemPos.FINDFIRST THEN
                                  BEGIN
                                    TempServRelaDoc.RESET;
                                    TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                                    TempServRelaDoc.SETFILTER("Nr.",'%1',GETFILTER("Nr."));
                                    TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                                    TempServRelaDoc.SETFILTER("Belegnr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                    TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                    IF NOT TempServRelaDoc.FINDFIRST THEN
                                      BEGIN
                                        ServRelaDoc.INIT;
                                        ServRelaDoc.Art := Art :: "SUP-AU";
                                        ServRelaDoc."Nr." := SalesLine_Service."Document No.";
                                        ServRelaDoc."Zeilennr." := zeilennr;
                                        ServRelaDoc."Belegnr." := ServicePos."Urspr. Lieferscheinnr.";
                                        ServRelaDoc."Belegzeilennr." := ServicePos."Urspr. Lieferscheinzeilennr.";
                                        ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
                                        ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                                        ServRelaDoc.VALIDATE("Ger„te Artikelnr.",ServicePos."Artikelnr.");
                                        ServRelaDoc.VALIDATE("Menge kalk.",ServicePos.Menge);
                                        CurrForm."Menge kalk.".UPDATE;
                                        ServRelaDoc."Vertragsnr. bernommen" := wartungsnr;
                                        ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
                                        ServRelaDoc.Fremderwerb := ServicePos.Fremderwerb;
                                        //Laufzeit vorbelegen
                                        Opt.RESET;
                                        Opt.SETFILTER("Tabellen ID",'%1',50024);
                                        Opt.SETFILTER("Feld ID",'%1',44);
                                        Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                                        IF Opt.FINDFIRST THEN
                                          ServRelaDoc.Laufzeit := Opt.Code;
                                        ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                                        ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                                        ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                                        ServRelaDoc.INSERT(TRUE);
                                      END
                                    ELSE
                                      BEGIN
                                        CompareSystemPos.RESET;
                                        CompareSystemPos.SETFILTER(Art,'%1',CompareSystemPos.Art :: System);
                                        CompareSystemPos.SETFILTER(Inaktiv,'%1',FALSE);
                                        CompareSystemPos.SETFILTER("Wartungsvertragsnr.",'%1',wartungsnr);
                                        CompareSystemPos.SETFILTER("Nr.",'%1',ServicePos."Urspr. Lieferscheinnr.");
                                        CompareSystemPos.SETFILTER("Belegzeilennr.",'%1',ServicePos."Urspr. Lieferscheinzeilennr.");
                                        IF CompareSystemPos.FINDFIRST THEN
                                          BEGIN
                                            menge_gesamt := 0;
                                            REPEAT
                                              menge_gesamt := menge_gesamt + CompareSystemPos.Menge;
                                            UNTIL CompareSystemPos.NEXT = 0;
                                            IF TempServRelaDoc."Menge kalk." < menge_gesamt THEN
                                              BEGIN
                                                TempServRelaDoc."Menge kalk." := TempServRelaDoc."Menge kalk." + ServicePos.Menge;
                                                TempServRelaDoc.MODIFY;
                                              END;
                                          END;
                                      END;
                                  END;
                              UNTIL ServicePos.NEXT = 0;
                              CurrForm.UPDATE;
                            END
                          ELSE
                            ERROR(Text000);
                        END
                      ELSE
                        ERROR(Text000);
                    END;
                END;
            END
          ELSE
            ERROR(Text000);
        END;
    END;

    PROCEDURE Logikšbernahme@1140009();
    VAR
      zeilennr_service@1140008 : Integer;
      zeilennr_ger„t@1140010 : Integer;
    BEGIN
      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER(Type,'%1',SalesLine_Service.Type :: Item);
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN
              IF (lieferscheinnr <> '') THEN ERROR(Text008);

              //Finde die logisch n„chst gelegene Position eines Serviceartikels, vor dieser Position
              zeilennr_service := 0;
              zeilennr_ger„t := 0;

              SalesLine.RESET;
              SalesLine.SETFILTER(Type,'%1',SalesLine.Type :: Item);
              SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
              SalesLine.SETFILTER("Line No.",'<%1',SalesLine_Service."Line No.");
              SalesLine.ASCENDING(FALSE);
              IF SalesLine.FINDFIRST THEN
                REPEAT
                  IF Artikel.GET(SalesLine."No.") THEN
                    BEGIN

                      IF (Artikel."Software Upgrade Protection" = TRUE) AND (zeilennr_ger„t <> 0) THEN
                        zeilennr_service := SalesLine."Line No.";

                      IF Artikel."Software Upgrade Protection" = FALSE THEN
                        zeilennr_ger„t := SalesLine."Line No.";

                    END;
                UNTIL (SalesLine.NEXT = 0) OR ((zeilennr_ger„t <> 0) AND (zeilennr_service <> 0));

              SalesLine.RESET;
              SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
              SalesLine.SETFILTER("Line No.",'%1..%2',zeilennr_service,SalesLine_Service."Line No.");
              SalesLine.SETFILTER("Manufacturer Code",'%1','59');
              IF SalesLine.FINDFIRST THEN
                ////Service bezieht sich auf Auftrag
                BEGIN
                  REPEAT
                    Artikel.GET(SalesLine."No.");
                    IF Artikel."Software Upgrade Protection" = FALSE THEN
                      BEGIN
                        TempServRelaDoc.RESET;
                        TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                        TempServRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
                        TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr);
                        TempServRelaDoc.SETFILTER("Belegnr.",'%1',SalesLine."Document No.");
                        TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',SalesLine."Line No.");
                        IF NOT TempServRelaDoc.FINDFIRST THEN
                          BEGIN
                            ServRelaDoc.INIT;
                            ServRelaDoc.Art := Art :: "SUP-AU";
                            ServRelaDoc."Nr." := SalesLine."Document No.";
                            ServRelaDoc."Zeilennr." := zeilennr;
                            ServRelaDoc."Belegnr." := SalesLine."Document No.";
                            ServRelaDoc."Belegzeilennr." := SalesLine."Line No.";
                            ServRelaDoc."Debitornr." := SalesLine."Sell-to Customer No.";
                            ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                            ServRelaDoc.VALIDATE("Ger„te Artikelnr.",SalesLine."No.");
                            ServRelaDoc."Menge kalk." := SalesLine."Outstanding Quantity";
                            //Laufzeit vorbelegen
                            Opt.RESET;
                            Opt.SETFILTER("Tabellen ID",'%1',50024);
                            Opt.SETFILTER("Feld ID",'%1',44);
                            Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                            IF Opt.FINDFIRST THEN
                              ServRelaDoc.Laufzeit := Opt.Code;
                            ServRelaDoc.VALIDATE("Quotenr.",quotenr);
                            ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
                            ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
                            ServRelaDoc.INSERT(TRUE);
                          END;
                      END;
                  UNTIL SalesLine.NEXT = 0;
                  CurrForm.UPDATE;
                END;
            END;
        END;
    END;

    PROCEDURE AnlageFremderwerbsPos@1140006();
    BEGIN
      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN
              ServRelaDoc.INIT;
              ServRelaDoc.Art := Art :: "SUP-AU";
              ServRelaDoc."Nr." := SalesLine_Service."Document No.";
              ServRelaDoc."Zeilennr." := zeilennr;
              ServRelaDoc."Belegnr." := PseudoBelegNrErmitteln(ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
              CheckServRelaDoc.RESET;
              CheckServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art);
              CheckServRelaDoc.SETFILTER("Nr.",'%1',SalesLine_Service."Document No.");
              CheckServRelaDoc.SETFILTER("Zeilennr.",'%1',ServRelaDoc."Zeilennr.");
              CheckServRelaDoc.SETFILTER(Fremderwerb,'%1',TRUE);
              IF NOT CheckServRelaDoc.FINDLAST THEN
                ServRelaDoc."Belegzeilennr." := 11111
              ELSE
                ServRelaDoc."Belegzeilennr." := CheckServRelaDoc."Belegzeilennr." + 11111;
              ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
              ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
              ServRelaDoc.Fremderwerb := TRUE;
              ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
              //Laufzeit vorbelegen
              Opt.RESET;
              Opt.SETFILTER("Tabellen ID",'%1',50024);
              Opt.SETFILTER("Feld ID",'%1',44);
              Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
              IF Opt.FINDFIRST THEN
                ServRelaDoc.Laufzeit := Opt.Code;
              ServRelaDoc.VALIDATE("Quotenr.",quotenr);
              ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
              ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
              ServRelaDoc.INSERT(TRUE);
            END;
        END;
    END;

    PROCEDURE AnlageFremderwerb_TEMP@1140019();
    BEGIN
      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN
              ServRelaDoc.INIT;
              ServRelaDoc.Art := Art :: "SUP-AU";
              ServRelaDoc."Nr." := SalesLine_Service."Document No.";
              ServRelaDoc."Zeilennr." := zeilennr;
              ServRelaDoc."Belegnr." := PseudoBelegNrErmitteln(ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
              CheckServRelaDoc.RESET;
              CheckServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art);
              CheckServRelaDoc.SETFILTER("Nr.",'%1',SalesLine_Service."Document No.");
              CheckServRelaDoc.SETFILTER("Zeilennr.",'%1',ServRelaDoc."Zeilennr.");
              CheckServRelaDoc.SETFILTER(Fremderwerb,'%1',TRUE);
              IF NOT CheckServRelaDoc.FINDLAST THEN
                ServRelaDoc."Belegzeilennr." := 11111
              ELSE
                ServRelaDoc."Belegzeilennr." := CheckServRelaDoc."Belegzeilennr." + 11111;
              ServRelaDoc."Debitornr." := SalesLine_Service."Sell-to Customer No.";
              ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
              ServRelaDoc.Fremderwerb := TRUE;
              ServRelaDoc."Nachtr„gliche Service Order" := TRUE;
              //Laufzeit vorbelegen
              Opt.RESET;
              Opt.SETFILTER("Tabellen ID",'%1',50024);
              Opt.SETFILTER("Feld ID",'%1',44);
              Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
              IF Opt.FINDFIRST THEN
                ServRelaDoc.Laufzeit := Opt.Code;
              ServRelaDoc.VALIDATE("Quotenr.",quotenr);
              ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",
              ServRelaDoc."Belegzeilennr.",ServRelaDoc.Basisger„t);
              ServRelaDoc.INSERT(TRUE);
            END;
        END;
    END;

    PROCEDURE PreiseKalkulieren@1140001();
    VAR
      Belegzeile@1140010 : Record 37;
      Ger„teArtikel@1140012 : Record 27;
      serv_price_au@1140004 : Decimal;
      serv_price_einzeln@1140005 : Decimal;
      serv_dc_au@1140009 : Decimal;
      serv_dc_einzeln@1140008 : Decimal;
      v_artikelnr@1140013 : Code[20];
      v_belegnr_fremd@1140016 : Code[20];
      v_laufzeit@1140006 : Integer;
      anzahl_basissysteme@1140014 : Integer;
      anzahl_basissysteme_fremd@1140015 : Integer;
      ACTS@1140003 : Boolean;
    BEGIN
      anzahl_basissysteme := 0;
      anzahl_basissysteme_fremd := 0;

      IF Rec.HASFILTER THEN
        BEGIN

          //Verbindet zur Belegzeile des zu kalkulierenden Service Artikels
          Belegzeile.RESET;
          Belegzeile.SETFILTER("Document No.",'%1',"Nr.");
          Belegzeile.SETFILTER("Line No.",'%1',"Zeilennr.");
          Belegzeile.FINDFIRST;

          //ACHAT
          Artikel.GET(Belegzeile."No.");
          IF (Artikel.Artikelgruppe = 'ACHAT') AND (kalk_prozentsatz < 50) THEN
            ERROR(Text018,Artikel.Artikelgruppe);

          //Verhindert jegliche Ausfhrungen oder Žnderungen, solange noch kein Basisger„t hinterlegt ist
          ServRelaDoc.RESET;
          ServRelaDoc.SETCURRENTKEY(Art,"Nr.","Zeilennr.",Gruppierung);
          ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art::"SUP-AU");
          ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
          ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
          ServRelaDoc.SETFILTER(Basisger„t,'%1',TRUE);
          IF NOT ServRelaDoc.FINDFIRST THEN
            BEGIN
              IF CONFIRM(Text010,FALSE) THEN
                BEGIN
                END
              ELSE
                EXIT;
            END
          ELSE
            REPEAT
              Ger„teArtikel.GET(ServRelaDoc."Ger„te Artikelnr.");
              IF (Ger„teArtikel.Serviceklassifizierung = 'SYSTEM FLAT') AND (ServRelaDoc.Fremderwerb = TRUE) THEN
                anzahl_basissysteme_fremd += 1;
              IF (v_artikelnr <> '') AND (ServRelaDoc."Ger„te Artikelnr." <> v_artikelnr) THEN
                ERROR(Text016);
              IF (v_artikelnr <> '') AND (ServRelaDoc."Ger„te Artikelnr." = v_artikelnr) AND (ServRelaDoc.Fremderwerb = TRUE)
              AND (ServRelaDoc."Belegnr." <> v_belegnr_fremd) AND (anzahl_basissysteme_fremd > 1) THEN
                ERROR(Text022);
              v_artikelnr := ServRelaDoc."Ger„te Artikelnr.";
              IF Ger„teArtikel.Serviceklassifizierung <> 'SYSTEM FLAT' THEN
                BEGIN
                  anzahl_basissysteme += 1;
                  IF anzahl_basissysteme > 1 THEN
                    ERROR(Text016);
                END;
              IF ServRelaDoc.Fremderwerb THEN
                v_belegnr_fremd := ServRelaDoc."Belegnr.";
            UNTIL ServRelaDoc.NEXT = 0;


          serv_price_au := 0;
          serv_dc_au := 0;
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          ServRelaDoc.RESET;
          ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art::"SUP-AU");
          ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
          ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
          IF ServRelaDoc.FINDFIRST THEN
            REPEAT
              IF (Pruefung_ignorieren(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",ServRelaDoc.Basisger„t) = FALSE)
              AND (ServRelaDoc."Menge kalk." > 1) THEN
                ERROR(Text001);

              IF (ServRelaDoc."Wartungsvertragsnr." <> '') AND (ServRelaDoc."Vertragsnr. bernommen" <> '') THEN
                ERROR(Text019);

              ServRelaDoc.TESTFIELD(Laufzeit);
              ServRelaDoc.TESTFIELD("Menge kalk.");

              IF ServRelaDoc.Fremderwerb = FALSE THEN
                BEGIN
                  SalesLine.RESET;
                  SalesLine.SETFILTER("Document No.",'%1',ServRelaDoc."Belegnr.");
                  SalesLine.SETFILTER("Line No.",'%1',ServRelaDoc."Belegzeilennr.");
                  SalesLine.SETFILTER(SalesLine."Outstanding Quantity",'>%1',0);
                  SalesLine.SETFILTER("Manufacturer Code",'%1','59');
                  IF SalesLine.FINDFIRST THEN
                    //Service bezieht sich auf Auftrag
                    BEGIN
                      EVALUATE(v_laufzeit,COPYSTR(ServRelaDoc.Laufzeit,1,STRPOS(ServRelaDoc.Laufzeit,'M')-1));
                      serv_price_einzeln := SalesLine.Gen_Service_VK(ServRelaDoc."SUP Artikelnr.",
                      ServRelaDoc."Ger„te Artikelnr.",v_laufzeit,ServRelaDoc."Belegnr.",ServRelaDoc."Belegzeilennr.",
                      ServRelaDoc.Fremderwerb,ServRelaDoc.Basisger„t,FALSE,kalk_prozentsatz,Belegzeile."Currency Code");
                      ServRelaDoc."Service VK-Preis einzeln" := serv_price_einzeln;
                      ServRelaDoc."Service VK-Preis Zeilenbetrag" := serv_price_einzeln * ServRelaDoc."Menge kalk.";
                      serv_price_au := serv_price_au + (ServRelaDoc."Menge kalk." * serv_price_einzeln);
                      serv_dc_einzeln := SalesLine.Gen_Service_DC(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",
                      v_laufzeit,FALSE,Belegzeile.Einkaufsw„hrungscode,ServRelaDoc."Quotenr.");
                      serv_dc_au := serv_dc_au + (ServRelaDoc."Menge kalk." * serv_dc_einzeln);
                      ServRelaDoc."Service DC einzeln" := serv_dc_einzeln;
                      ServRelaDoc."Service DC Gesamt" := serv_dc_einzeln * ServRelaDoc."Menge kalk.";
                      ServRelaDoc."Service DC W„hrungscode" := EKW„hrungholen(ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
                      ServRelaDoc."MSRP Service" := SalesLine.FindMSRP(ServRelaDoc."Ger„te Artikelnr.",WORKDATE,
                      Belegzeile."Currency Code",SalesLine."Unit of Measure Code",ServRelaDoc."SUP Artikelnr.");
                      ServRelaDoc."Rabatt/Marge" := kalk_prozentsatz;
                      ServRelaDoc.MODIFY;
                    END
                  ELSE
                    //Service bezieht sich auf Lieferschein
                    BEGIN
                      ShipLine.RESET;
                      ShipLine.SETFILTER("Document No.",'%1',ServRelaDoc."Belegnr.");
                      ShipLine.SETFILTER("Line No.",'%1',ServRelaDoc."Belegzeilennr.");
                      ShipLine.SETFILTER(ShipLine.Quantity,'>%1',0);
                      ShipLine.SETFILTER("Manufacturer Code",'%1','59');
                      IF ShipLine.FINDFIRST THEN
                        BEGIN
                          ShipLine.CALCFIELDS("Currency Code");
                          EVALUATE(v_laufzeit,COPYSTR(ServRelaDoc.Laufzeit,1,STRPOS(ServRelaDoc.Laufzeit,'M')-1));
                          //Funktion im Lieferschein einbauen???
                          serv_price_einzeln := SalesLine.Gen_Service_VK(ServRelaDoc."SUP Artikelnr.",
                          ServRelaDoc."Ger„te Artikelnr.",v_laufzeit,ServRelaDoc."Belegnr.",ServRelaDoc."Belegzeilennr.",
                          ServRelaDoc.Fremderwerb,ServRelaDoc.Basisger„t,FALSE,kalk_prozentsatz,Belegzeile."Currency Code");
                          ServRelaDoc."Service VK-Preis einzeln" := serv_price_einzeln;
                          ServRelaDoc."Service VK-Preis Zeilenbetrag" := serv_price_einzeln * ServRelaDoc."Menge kalk.";
                          serv_price_au := serv_price_au + (ServRelaDoc."Menge kalk." * serv_price_einzeln);
                          serv_dc_einzeln := SalesLine.Gen_Service_DC(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",
                          v_laufzeit,FALSE,Belegzeile.Einkaufsw„hrungscode,ServRelaDoc."Quotenr.");
                          serv_dc_au := serv_dc_au + (ServRelaDoc."Menge kalk." * serv_dc_einzeln);
                          ServRelaDoc."Service DC einzeln" := serv_dc_einzeln;
                          ServRelaDoc."Service DC Gesamt" := serv_dc_einzeln * ServRelaDoc."Menge kalk.";
                          ServRelaDoc."Service DC W„hrungscode" := EKW„hrungholen(ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
                          ServRelaDoc."MSRP Service" := SalesLine.FindMSRP(ServRelaDoc."Ger„te Artikelnr.",WORKDATE,
                          Belegzeile."Currency Code",ShipLine."Unit of Measure Code",ServRelaDoc."SUP Artikelnr.");
                          ServRelaDoc."Rabatt/Marge" := kalk_prozentsatz;
                          ServRelaDoc.MODIFY;
                        END;
                    END;
                END
              ELSE
                //Service bezieht sich auf Pseudo Positionen
                BEGIN
                  EVALUATE(v_laufzeit,COPYSTR(ServRelaDoc.Laufzeit,1,STRPOS(ServRelaDoc.Laufzeit,'M')-1));
                  serv_price_einzeln := SalesLine.Gen_Service_VK(ServRelaDoc."SUP Artikelnr.",
                  ServRelaDoc."Ger„te Artikelnr.",v_laufzeit,ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.",
                  ServRelaDoc.Fremderwerb,ServRelaDoc.Basisger„t,FALSE,kalk_prozentsatz,Belegzeile."Currency Code");
                  ServRelaDoc."Service VK-Preis einzeln" := serv_price_einzeln;
                  ServRelaDoc."Service VK-Preis Zeilenbetrag" := serv_price_einzeln * ServRelaDoc."Menge kalk.";
                  serv_price_au := serv_price_au + (ServRelaDoc."Menge kalk." * serv_price_einzeln);
                  serv_dc_einzeln := SalesLine.Gen_Service_DC(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",
                  v_laufzeit,FALSE,Belegzeile.Einkaufsw„hrungscode,ServRelaDoc."Quotenr.");
                  serv_dc_au := serv_dc_au + (ServRelaDoc."Menge kalk." * serv_dc_einzeln);
                  ServRelaDoc."Service DC einzeln" := serv_dc_einzeln;
                  ServRelaDoc."Service DC Gesamt" := serv_dc_einzeln * ServRelaDoc."Menge kalk.";
                  ServRelaDoc."Service DC W„hrungscode" := EKW„hrungholen(ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
                  ServRelaDoc."MSRP Service" := SalesLine.FindMSRP(ServRelaDoc."Ger„te Artikelnr.",WORKDATE,
                  Belegzeile."Currency Code",SalesLine."Unit of Measure Code",ServRelaDoc."SUP Artikelnr.");
                  ServRelaDoc."Rabatt/Marge" := kalk_prozentsatz;
                  ServRelaDoc.MODIFY;
                END;

            UNTIL ServRelaDoc.NEXT = 0;

            IF serv_price_au <> 0 THEN
              BEGIN
                serv_price_au := ROUND(serv_price_au,1);
                SalesLine.RESET;
                SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
                SalesLine.SETFILTER("Line No.",'%1',zeilennr);
                IF SalesLine.FINDFIRST THEN
                  BEGIN
                    IF (SalesLine."Unit Price" <> serv_price_au) AND (SalesLine."Unit Price" <> 0) THEN
                      IF NOT CONFIRM(Text003,TRUE,Artikel.Artikelgruppe) THEN
                        EXIT;

                    SalesLine.VALIDATE(SalesLine."DC-Preis (EKW)",serv_dc_au);
                    SalesLine.VALIDATE("Unit Price",serv_price_au);
                    SalesLine.MODIFY;

                    MESSAGE(Text004,Artikel.Artikelgruppe,serv_price_au,SalesLine.FIELDCAPTION("DC-Preis (EKW)"),
                            SalesLine."DC-Preis (EKW)");
                 END;
              END
            ELSE
              MESSAGE(Text005,Artikel.Artikelgruppe);
        END;
    END;

    PROCEDURE EKW„hrungholen@1140010(Belegnr@1140001 : Code[20];Belegzeilennr@1140002 : Integer) : Code[20];
    VAR
      Belegzeile@1140000 : Record 37;
    BEGIN
      Belegzeile.RESET;
      Belegzeile.SETFILTER("Document No.",'%1',Belegnr);
      Belegzeile.SETFILTER("Line No.",'%1',Belegzeilennr);
      IF Belegzeile.FINDFIRST THEN
        EXIT(Belegzeile.Einkaufsw„hrungscode)
      ELSE
        EXIT('');
    END;

    PROCEDURE TempSeriennrhinzu@1140002();
    BEGIN
      TESTFIELD("Nr.");
      TESTFIELD("Zeilennr.");
      TESTFIELD(Art,Art::"SUP-AU");
      TESTFIELD("Debitornr.");
      TESTFIELD("Menge kalk.");
      TESTFIELD("Ger„te Artikelnr.");

      //***************************************************************************************************
      //                          Es muss ein System Basisger„te vorhanden sein
      //              Ausnahme: Alle Kalkulationszeilen haben eine Wartungsvertragsnr.
      //***************************************************************************************************

      ServRelaDoc.RESET;
      ServRelaDoc.SETCURRENTKEY(Art,"Nr.","Zeilennr.",Gruppierung);
      ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art :: "SUP-AU");
      ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
      ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
      ServRelaDoc.SETFILTER(Basisger„t,'%1',TRUE);
      IF NOT ServRelaDoc.FINDFIRST THEN
        BEGIN
          ServRelaDoc.SETFILTER(Basisger„t,'%1|%2',TRUE,FALSE);
          IF ServRelaDoc.FINDFIRST THEN
            REPEAT
              IF ServRelaDoc."Wartungsvertragsnr." = '' THEN
                ERROR(Text010);
            UNTIL ServRelaDoc.NEXT = 0;
        END;

      ServRelaDoc.RESET;
      ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art::"SUP-AU");
      ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
      ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
      ServRelaDoc.SETFILTER("Nachtr„gliche Service Order",'%1',TRUE);
      IF ServRelaDoc.FINDFIRST THEN
        REPEAT
          IF (Pruefung_ignorieren(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",ServRelaDoc.Basisger„t) = FALSE)
          AND (ServRelaDoc."Menge kalk." > 1)  THEN
            ERROR(Text001);
          ShowSerialNo.RESET;
          ShowSerialNo.ACSLizenzenHinzu(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Belegnr.",ServRelaDoc."Belegzeilennr.",
                         ServRelaDoc."Menge kalk.",ServRelaDoc."Debitornr.",ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
        UNTIL ServRelaDoc.NEXT = 0;

      ServicePos.RESET;
      ServicePos.SETRANGE(Art,ServicePos.Art :: Tempor„r);
      ServicePos.SETRANGE("Auftragsnr.","Nr.");
      ServicePos.SETRANGE("Auftragszeilennr.","Zeilennr.");
      IF ServicePos.FINDFIRST THEN
        FORM.RUN(50027,ServicePos);
    END;

    PROCEDURE TempSeriennrhinzu_TEMP@1140015();
    BEGIN
      TESTFIELD("Nr.");
      TESTFIELD("Zeilennr.");
      TESTFIELD(Art,Art::"SUP-AU");
      TESTFIELD("Debitornr.");
      TESTFIELD("Menge kalk.");
      TESTFIELD("Ger„te Artikelnr.");

      //***************************************************************************************************
      //                          Es muss ein System Basisger„te vorhanden sein
      //              Ausnahme: Alle Kalkulationszeilen haben eine Wartungsvertragsnr.
      //***************************************************************************************************

      ServRelaDoc.RESET;
      ServRelaDoc.SETCURRENTKEY(Art,"Nr.","Zeilennr.",Gruppierung);
      ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art :: "SUP-AU");
      ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
      ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
      ServRelaDoc.SETFILTER(Basisger„t,'%1',TRUE);
      IF NOT ServRelaDoc.FINDFIRST THEN
        BEGIN
          ServRelaDoc.SETFILTER(Basisger„t,'%1|%2',TRUE,FALSE);
          IF ServRelaDoc.FINDFIRST THEN
            REPEAT
              IF ServRelaDoc."Wartungsvertragsnr." = '' THEN
                ERROR(Text010);
            UNTIL ServRelaDoc.NEXT = 0;
        END;

      ServRelaDoc.RESET;
      ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art::"SUP-AU");
      ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
      ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
      ServRelaDoc.SETFILTER("Nachtr„gliche Service Order",'%1',TRUE);
      IF ServRelaDoc.FINDFIRST THEN
        REPEAT
          IF (Pruefung_ignorieren(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Ger„te Artikelnr.",ServRelaDoc.Basisger„t) = FALSE)
          AND (ServRelaDoc."Menge kalk." > 1)  THEN
            ERROR(Text001);
          ShowSerialNo.RESET;
          ShowSerialNo.ACSLizenzenHinzu(ServRelaDoc."SUP Artikelnr.",ServRelaDoc."Belegnr.",ServRelaDoc."Belegzeilennr.",
                         ServRelaDoc."Menge kalk.",ServRelaDoc."Debitornr.",ServRelaDoc."Nr.",ServRelaDoc."Zeilennr.");
        UNTIL ServRelaDoc.NEXT = 0;

      ServicePos.RESET;
      ServicePos.SETFILTER(Art,'%1',ServicePos.Art :: Tempor„r);
      ServicePos.SETFILTER("Auftragsnr.",'%1',"Nr.");
      ServicePos.SETFILTER("Auftragszeilennr.",'%1',"Zeilennr.");
      IF ServicePos.FINDFIRST THEN
        FORM.RUN(50027,ServicePos);
    END;

    PROCEDURE KalkFehlerPrfen@1140003();
    VAR
      AktBeleg@1140002 : Record 36;
      kalk_preis_gesamt@1140003 : Decimal;
      menge_auswahl@1140004 : Integer;
    BEGIN
      hinweistext := '';
      kalk_preis_gesamt := 0;

      AktBeleg.RESET;
      AktBeleg.SETRANGE("No.","Nr.");
      IF NOT AktBeleg.FINDFIRST THEN
        EXIT;

      ServRelaDoc.RESET;
      ServRelaDoc.SETRANGE(Art,ServRelaDoc.Art::"SUP-AU");
      ServRelaDoc.SETRANGE("Nr.","Nr.");
      ServRelaDoc.SETRANGE("Zeilennr.","Zeilennr.");
      IF ServRelaDoc.FINDFIRST THEN
        REPEAT

          //Prft, ob die Angaben der Kalkulation bgzl. Ger„te Artikelnr. noch stimmig zum Beleg sind
          IF (ServRelaDoc."Nachtr„gliche Service Order" = FALSE) AND (ServRelaDoc.Fremderwerb = FALSE) THEN
            BEGIN
              SalesLine.RESET;
              SalesLine.SETRANGE(Type,SalesLine.Type :: Item);
              SalesLine.SETRANGE("Document No.",ServRelaDoc."Belegnr.");
              SalesLine.SETRANGE("Line No.",ServRelaDoc."Belegzeilennr.");
              IF SalesLine.FINDFIRST THEN
                BEGIN
                  IF SalesLine."No." <> ServRelaDoc."Ger„te Artikelnr." THEN
                    hinweistext := 'Die Artikelnr. '+ ServRelaDoc."Ger„te Artikelnr." + ' entspricht nicht mehr der Angabe '+
                                   'aus ' + ServRelaDoc."Belegnr." + ', ' + FORMAT(ServRelaDoc."Belegzeilennr.");
                END
              ELSE
                hinweistext := 'Die Angabe ' + ServRelaDoc."Ger„te Artikelnr." + ' in ' + ServRelaDoc."Belegnr." + ', ' +
                FORMAT(ServRelaDoc."Belegzeilennr.") + ' existiert nicht mehr im Beleg.';
            END;

          //Prft, ob noch Seriennr. ausgew„hlt werden mssen
          IF ServRelaDoc."Nachtr„gliche Service Order" = TRUE THEN
            BEGIN
              SystemPos.RESET;
              SystemPos.SETRANGE(Art,SystemPos.Art :: Tempor„r);
              SystemPos.SETRANGE("Auftragsnr.",ServRelaDoc."Nr.");
              SystemPos.SETRANGE("Auftragszeilennr.",ServRelaDoc."Zeilennr.");
              SystemPos.SETRANGE("Nr.",ServRelaDoc."Belegnr.");
              SystemPos.SETRANGE("Belegzeilennr.",ServRelaDoc."Belegzeilennr.");
              SystemPos.SETRANGE("Artikelnr.",ServRelaDoc."Ger„te Artikelnr.");
              SystemPos.SETRANGE(Vormerkung,TRUE);
              IF NOT SystemPos.FINDFIRST THEN
                BEGIN
                  hinweistext := 'Fr Artikelnr. ' + ServRelaDoc."Ger„te Artikelnr." + ' wurden noch nicht gengend ' +
                                 'Seriennr. ausgew„hlt.';
                END
              ELSE
                BEGIN
                  menge_auswahl := 0;
                  REPEAT
                    menge_auswahl := menge_auswahl + SystemPos.Menge;
                  UNTIL SystemPos.NEXT = 0;
                  IF ServRelaDoc."Menge kalk." > menge_auswahl THEN
                    hinweistext := 'Fr Artikelnr. ' + ServRelaDoc."Ger„te Artikelnr." + ' wurden noch nicht gengend ' +
                                   'Seriennr. ausgew„hlt.';
                END;
            END;

          //Prft, ob eine Zeile einen Zeilenbetrag von 0 ausweist
          IF ServRelaDoc."Service VK-Preis Zeilenbetrag" = 0 THEN
            hinweistext := 'Der ' + ServRelaDoc.FIELDCAPTION("Service VK-Preis Zeilenbetrag")
                            + ' fr ' + ServRelaDoc."Ger„te Artikelnr." + ' betr„gt 0.';

          kalk_preis_gesamt := kalk_preis_gesamt + ServRelaDoc."Service VK-Preis Zeilenbetrag";

        UNTIL ServRelaDoc.NEXT = 0;

      //Prft, ob der Beleg VK-Preis noch mit dem Kalkulations Gesamtpreis bereinstimmt
      SalesLine.RESET;
      SalesLine.SETRANGE("Document No.",ServRelaDoc."Nr.");
      SalesLine.SETRANGE("Line No.",ServRelaDoc."Zeilennr.");
      IF SalesLine.FINDFIRST THEN
        IF ROUND(kalk_preis_gesamt,1) <> SalesLine."Unit Price" THEN
          hinweistext := 'Der Vk-Preis im Beleg stimmt nicht mit dem Gesamtpreis der Kalkulation berein.';

      //Warnung,wenn nur Module hinterlegt sind und die Vertragsnr. leer bleiben
      ServRelaDoc.RESET;
      ServRelaDoc.SETCURRENTKEY(Art,"Nr.","Zeilennr.",Gruppierung);
      ServRelaDoc.SETRANGE(Art,ServRelaDoc.Art::"SUP-AU");
      ServRelaDoc.SETRANGE("Nr.","Nr.");
      ServRelaDoc.SETRANGE("Zeilennr.","Zeilennr.");
      ServRelaDoc.SETRANGE(Basisger„t,TRUE);
      IF NOT ServRelaDoc.FINDFIRST THEN
        BEGIN
          ServRelaDoc.SETRANGE(Basisger„t);
          ServRelaDoc.SETRANGE("Wartungsvertragsnr.",'');
          IF ServRelaDoc.FINDFIRST THEN
            hinweistext := 'Bitte fllen Sie die Wartungsvertragsnr. aus.';
        END;
    END;

    PROCEDURE MengeKalkPrfen@1140008();
    BEGIN
      IF Fremderwerb = TRUE THEN
        EXIT;

      SalesLine.RESET;
      SalesLine.SETFILTER("Document No.",'%1',"Belegnr.");
      SalesLine.SETFILTER("Line No.",'%1',"Belegzeilennr.");
      IF SalesLine.FINDFIRST THEN
        BEGIN
          IF "Menge kalk." > SalesLine.Quantity THEN
            ERROR(Text006,FIELDCAPTION("Menge kalk."),SalesLine.Quantity);
        END
      ELSE
        BEGIN
          ShipLine.RESET;
          ShipLine.SETFILTER("Document No.",'%1',"Belegnr.");
          ShipLine.SETFILTER("Line No.",'%1',"Belegzeilennr.");
          IF ShipLine.FINDFIRST THEN
            BEGIN
              IF "Menge kalk." > ShipLine.Quantity THEN
                ERROR(Text006,FIELDCAPTION("Menge kalk."),ShipLine.Quantity);
            END
          ELSE
            ERROR('Error');
        END;
    END;

    PROCEDURE AusfhrungPrfen@1140005();
    VAR
      AktBeleg@1140000 : Record 36;
    BEGIN
      AktBeleg.RESET;
      AktBeleg.SETFILTER("No.",'%1',"Nr.");
      IF NOT AktBeleg.FINDFIRST THEN
        ERROR(Text007);
    END;

    PROCEDURE Vorg„ngerKopieren@1140011();
    VAR
      zeilennr_service@1140001 : Integer;
    BEGIN
      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          SalesLine_Service.RESET;
          SalesLine_Service.SETFILTER(Type,'%1',SalesLine_Service.Type :: Item);
          SalesLine_Service.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine_Service.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine_Service.FINDFIRST THEN
            BEGIN

              //Finde die logisch n„chst gelegene Position eines Serviceartikels, vor dieser Position
              zeilennr_service := 0;

              SalesLine.RESET;
              SalesLine.SETFILTER(Type,'%1',SalesLine.Type :: Item);
              SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
              SalesLine.SETFILTER("Line No.",'<%1',zeilennr);
              SalesLine.ASCENDING(FALSE);
              IF SalesLine.FINDFIRST THEN
                BEGIN
                  REPEAT
                    IF Artikel.GET(SalesLine."No.") THEN
                      BEGIN

                        IF (Artikel."Software Upgrade Protection" = TRUE) THEN
                          zeilennr_service := SalesLine."Line No.";

                      END;
                  UNTIL (SalesLine.NEXT = 0) OR (zeilennr_service <> 0);
                END;

                IF zeilennr_service = 0 THEN EXIT;

                TempServRelaDoc.RESET;
                TempServRelaDoc.SETFILTER(Art,'%1',TempServRelaDoc.Art::"SUP-AU");
                TempServRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
                TempServRelaDoc.SETFILTER("Zeilennr.",'%1',zeilennr_service);
                //TempServRelaDoc.SETFILTER("Belegnr.",'%1',SalesLine."Document No.");
                //TempServRelaDoc.SETFILTER("Belegzeilennr.",'%1',SalesLine."Line No.");
                IF TempServRelaDoc.FINDFIRST THEN
                  BEGIN
                    REPEAT
                      ServRelaDoc.INIT;
                      ServRelaDoc.Art := Art :: "SUP-AU";
                      ServRelaDoc."Nr." := SalesLine."Document No.";
                      ServRelaDoc."Zeilennr." := zeilennr;
                      ServRelaDoc."Belegnr." := TempServRelaDoc."Belegnr.";
                      ServRelaDoc."Belegzeilennr." := TempServRelaDoc."Belegzeilennr.";
                      ServRelaDoc."Debitornr." := TempServRelaDoc."Debitornr.";
                      ServRelaDoc."SUP Artikelnr." := SalesLine_Service."No.";
                      ServRelaDoc.VALIDATE("Ger„te Artikelnr.",TempServRelaDoc."Ger„te Artikelnr.");
                      ServRelaDoc."Menge kalk." := TempServRelaDoc."Menge kalk.";
                      ServRelaDoc."Laufzeit ab Buchungsdatum" := TempServRelaDoc."Laufzeit ab Buchungsdatum";
                      ServRelaDoc."Vertragsnr. bernommen" := TempServRelaDoc."Vertragsnr. bernommen";
                      ServRelaDoc."Abw. Ger„te Artikelnr." := TempServRelaDoc."Abw. Ger„te Artikelnr.";
                      ServRelaDoc."Nachtr„gliche Service Order" := TempServRelaDoc."Nachtr„gliche Service Order";
                      ServRelaDoc.Fremderwerb := TempServRelaDoc.Fremderwerb;
                      //Laufzeit vorbelegen
                      IF (TempServRelaDoc.Startdatum <> 0D) OR (TempServRelaDoc.Ablaufdatum <> 0D) THEN
                        BEGIN
                          ServRelaDoc.VALIDATE(Laufzeit,TempServRelaDoc.Laufzeit);
                          ServRelaDoc.VALIDATE(Startdatum,TempServRelaDoc.Startdatum);
                          ServRelaDoc.VALIDATE(Ablaufdatum,TempServRelaDoc.Ablaufdatum);
                        END
                      ELSE
                        BEGIN
                          Opt.RESET;
                          Opt.SETFILTER("Tabellen ID",'%1',50024);
                          Opt.SETFILTER("Feld ID",'%1',44);
                          Opt.SETFILTER("Nr.",'%1',ServRelaDoc."SUP Artikelnr.");
                          IF Opt.FINDFIRST THEN
                            ServRelaDoc.Laufzeit := Opt.Code;
                        END;
                      IF TempServRelaDoc."Wartungsvertragsnr." <> '' THEN
                        BEGIN
                          ServRelaDoc.VALIDATE(Laufzeit,TempServRelaDoc.Laufzeit);
                          ServRelaDoc.VALIDATE("Wartungsvertragsnr.",TempServRelaDoc."Wartungsvertragsnr.");
                        END;
                      ServRelaDoc.VALIDATE("Quotenr.",TempServRelaDoc."Quotenr.");
                      ServRelaDoc.Gruppierung := Gruppieren(ServRelaDoc."Belegnr.",ServRelaDoc."Belegzeilennr.",
                      ServRelaDoc.Basisger„t);
                      ServRelaDoc.INSERT(TRUE);
                    UNTIL TempServRelaDoc.NEXT = 0;
                  END;
                CurrForm.UPDATE;

           END;
        END;
    END;

    PROCEDURE InfosExcelExport@1140000();
    VAR
      text_array@1140000 : ARRAY [5] OF Text[255];
      v_wartungsnr@1140002 : Code[20];
      k@1140001 : Integer;
    BEGIN
      // Definiert die zu importierende Datei
      IF (wartungsnr = '') AND ("Vertragsnr. bernommen" = '') THEN
        ERROR(Text013,Wartungsvertrag.FIELDCAPTION("Wartungsvertragsnr."));

      IF "Vertragsnr. bernommen" <> '' THEN
        v_wartungsnr := "Vertragsnr. bernommen"
      ELSE
        v_wartungsnr := wartungsnr;

      //array 1 = Lieferschein Nr.
      //array 2 = Vertragsablaufdatum
      //array 3 = Ger„te Artikelnr.

      ServRelaDoc.RESET;
      ServRelaDoc.SETFILTER(Art,'%1',ServRelaDoc.Art::"SUP-AU");
      ServRelaDoc.SETFILTER("Nr.",'%1',"Nr.");
      ServRelaDoc.SETFILTER("Zeilennr.",'%1',"Zeilennr.");
      //ServRelaDoc.SETFILTER(Fremderwerb,'%1',FALSE);
      IF ServRelaDoc.FINDFIRST THEN
        BEGIN

          Wartungsvertrag.GET(v_wartungsnr);
          IF Wartungsvertrag.Endkunde = '' THEN
            j := '6'
          ELSE
            j := '7';

          CLEAR(Excel);

          CREATE (Excel);
          Book := Excel.Workbooks.Add(-4167);           //legt neue datei in excel an
          Sheet := Excel.ActiveSheet;                   //definiert aktives worksheet

          //Feste Werte
          Sheet.Range('A1').Value := 'Serviceverl„ngerung fr folgendes System:';
          Sheet.Range('A2').Value := 'Lieferscheinnr.: ';
          Sheet.Range('A3').Value := 'Ende der Vertragslaufzeit:';

          REPEAT

            ServicePos.RESET;
            ServicePos.SETFILTER(Art,'%1',ServicePos.Art :: Service);
            ServicePos.SETFILTER("Wartungsvertragsnr.",'%1',v_wartungsnr);
            ServicePos.SETFILTER("Urspr. Lieferscheinnr.",'%1',ServRelaDoc."Belegnr.");
            ServicePos.SETFILTER("Urspr. Lieferscheinzeilennr.",'%1',ServRelaDoc."Belegzeilennr.");
            ServicePos.SETFILTER(Lizenzdatum,'<>%1',0D);
            ServicePos.SETFILTER(Inaktiv,'%1',FALSE);
            IF ServicePos.FINDFIRST THEN
              BEGIN
                IF ServRelaDoc.Fremderwerb = FALSE THEN
                  BEGIN
                    text_array[1] := Sheet.Range('A2').Value;

                    IF STRPOS(text_array[1],ServicePos."Urspr. Lieferscheinnr.") = 0 THEN
                      IF STRPOS(text_array[1],'LS') > 0 THEN
                        text_array[1] := text_array[1] + ', ' + ServicePos."Urspr. Lieferscheinnr."
                      ELSE
                        text_array[1] := text_array[1] + ServicePos."Urspr. Lieferscheinnr.";
                    Sheet.Range('A2').Value := text_array[1];
                  END;

                k := 1;
                text_array[3] := ServRelaDoc."Ger„te Artikelnr.";

                REPEAT

                  IF STRLEN(text_array[3]) = STRLEN(ServRelaDoc."Ger„te Artikelnr.") THEN
                    BEGIN
                      text_array[3] := FORMAT(ServRelaDoc."Menge kalk.") + 'x ' + text_array[3]
                    END;
                  IF STRPOS(text_array[3],ServicePos."Seriennr.") = 0 THEN
                    BEGIN
                      IF k = 1 THEN
                        text_array[3] := text_array[3] + '  ' + ServicePos."Seriennr."
                      ELSE
                        text_array[3] := text_array[3] + ', ' + ServicePos."Seriennr.";
                      k += 1;
                    END;

                UNTIL ServicePos.NEXT = 0;

                Sheet.Range('A'+j).Value := text_array[3];

                j := INCSTR(j);

              END;

             IF ServRelaDoc.Basisger„t = TRUE THEN
               BEGIN
                 Wartungsvertrag.GET(v_wartungsnr);
                 text_array[2] := Sheet.Range('A3').Value;
                 IF STRPOS(text_array[2], FORMAT(Wartungsvertrag.Vertragsablaufdatum)) = 0 THEN
                   text_array[2] := text_array[2] + ' ' + FORMAT(Wartungsvertrag.Vertragsablaufdatum);
                 Sheet.Range('A3').Value := text_array[2];
                 Sheet.Range('A4').Value := 'Vertragsnr.: ' + Wartungsvertrag."Wartungsvertragsnr.";
                 IF Wartungsvertrag.Endkunde <> '' THEN
                   Sheet.Range('A5').Value := 'Endkunde: ' + Wartungsvertrag.Endkunde;
                 SystemPos.RESET;
                 SystemPos.SETRANGE(Basisger„t,TRUE);
                 SystemPos.SETRANGE("Artikelnr.",ServRelaDoc."Ger„te Artikelnr.");
                 SystemPos.SETRANGE("Nr.",ServRelaDoc."Belegnr.");
                 SystemPos.SETRANGE("Seriennr.",ServicePos."Seriennr.");
                 SystemPos.SETRANGE("Belegzeilennr.",ServRelaDoc."Belegzeilennr.");
                 IF SystemPos.FINDFIRST THEN
                   Sheet.Range('A4').Value := FORMAT(Sheet.Range('A4').Value) + ' / Board ini: ' + SystemPos."Board ini";
               END;

          UNTIL ServRelaDoc.NEXT = 0;

          Excel.Visible(TRUE);
        END;

      CLEAR(Excel);
    END;

    PROCEDURE L”schAllePos@1140004();
    BEGIN
      IF Rec.HASFILTER THEN
        BEGIN
          IF CONFIRM('Wollen Sie diese Kalkulation wirklich l”schen?') THEN
            DELETEALL(TRUE);
        END;
    END;

    PROCEDURE AktFormTemplate@1140012();
    VAR
      v_Art@1140000 : Text[30];
    BEGIN
      EVALUATE(v_Art,GETFILTER(Art));
      CASE v_Art OF
        'SUP-AU' :
          BEGIN
            CurrForm.btn_neue_pos.VISIBLE(FALSE);
            CurrForm.btn_demo_vorlage.VISIBLE(FALSE);
            CurrForm."Service VK-Preis einzeln".VISIBLE(TRUE);
            CurrForm."Service VK-Preis Zeilenbetrag".VISIBLE(TRUE);
            CurrForm."Service DC einzeln".VISIBLE(TRUE);
            CurrForm."Service DC Gesamt".VISIBLE(TRUE);
            CurrForm."Service DC W„hrungscode".VISIBLE(TRUE);
            CurrForm."Wartungsvertragsnr.".VISIBLE(TRUE);
            CurrForm.Laufzeit.VISIBLE(TRUE);
            CurrForm.Startdatum.VISIBLE(TRUE);
            CurrForm.Ablaufdatum.VISIBLE(TRUE);
            CurrForm."Vertragsnr. bernommen".VISIBLE(TRUE);
            CurrForm."MSRP Service".VISIBLE(TRUE);
            CurrForm."Quotenr.".VISIBLE(TRUE);
            Artikel.GET("SUP Artikelnr.");
            IF Artikel.Artikelgruppe ='CHAMPS_PARTNER' THEN
              kalk_prozentsatz := 20;
          END;
        'SPL-AU' :
          BEGIN
            CurrForm.btn_auswahl_sn.VISIBLE(FALSE);
            CurrForm.label_hinweistext.VISIBLE(FALSE);
            CurrForm.btn_alle_pos_holen.VISIBLE(FALSE);
            CurrForm.btn_preise_berechnen.VISIBLE(FALSE);
            CurrForm.btn_auswahl_sn.VISIBLE(FALSE);
            CurrForm.btn_extra_funktionen.VISIBLE(FALSE);
            CurrForm.btn_exportto_excel.VISIBLE(FALSE);
            CurrForm.label_hinweistext.VISIBLE(FALSE);
            CurrForm.label_hinweis_lieferschein.VISIBLE(FALSE);
            CurrForm.txtbox_lieferscheinnr.VISIBLE(FALSE);
            CurrForm.txtbox_vertragsnr.VISIBLE(FALSE);
            CurrForm.label_hinweis_vertr„ge.VISIBLE(FALSE);
            CurrForm."Service VK-Preis einzeln".VISIBLE(FALSE);
            CurrForm."Service VK-Preis Zeilenbetrag".VISIBLE(FALSE);
            CurrForm."Service DC einzeln".VISIBLE(FALSE);
            CurrForm."Service DC Gesamt".VISIBLE(FALSE);
            CurrForm."Service DC W„hrungscode".VISIBLE(FALSE);
            CurrForm."Wartungsvertragsnr.".VISIBLE(FALSE);
            CurrForm.Laufzeit.VISIBLE(FALSE);
            CurrForm.Startdatum.VISIBLE(FALSE);
            CurrForm.Ablaufdatum.VISIBLE(FALSE);
            CurrForm."Vertragsnr. bernommen".VISIBLE(FALSE);
            CurrForm."MSRP Service".VISIBLE(FALSE);
            CurrForm."Quotenr.".VISIBLE(FALSE);
          END;
      END;
    END;

    PROCEDURE DemoVorlage@1140013();
    VAR
      DemolistRelaDoc@1140003 : Record 50027;
      PrfeDemolistRelaDoc@1140005 : Record 50027;
      Opt_License@1140006 : Record 50001;
      demo_artikel@1140000 : ARRAY [20] OF Code[20];
      anzahl@1140001 : Integer;
      k@1140004 : Integer;
    BEGIN
      //Splicecom Funktion
      EVALUATE(zeilennr,GETFILTER("Zeilennr."));
      SalesLine.RESET;
      SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
      SalesLine.SETFILTER("Line No.",'%1',zeilennr);
      IF SalesLine.FINDFIRST THEN ;

      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));
          SalesLine.RESET;
          SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine.FINDFIRST THEN
            BEGIN
              Opt_License.RESET;
              Opt_License.SETCURRENTKEY("Tabellen ID","Feld ID","Lfd.-Nr.");
              Opt_License.SETFILTER("Tabellen ID",'%1',50027);
              Opt_License.SETFILTER("Feld ID",'%1',5);
              Opt_License.SETFILTER(Code,'%1',SalesLine."No.");
              IF Opt_License.FINDFIRST THEN
                REPEAT
                  DemolistRelaDoc.INIT;
                  DemolistRelaDoc.Art := Art :: "SPL-AU";
                  DemolistRelaDoc."Nr." := SalesLine."Document No.";
                  DemolistRelaDoc."Zeilennr." := zeilennr;
                  DemolistRelaDoc."Belegnr." := SalesLine."Document No.";
                  PrfeDemolistRelaDoc.RESET;
                  PrfeDemolistRelaDoc.SETFILTER(Art,'%1',DemolistRelaDoc.Art);
                  PrfeDemolistRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
                  PrfeDemolistRelaDoc.SETFILTER("Zeilennr.",'%1',DemolistRelaDoc."Zeilennr.");
                  IF NOT PrfeDemolistRelaDoc.FINDLAST THEN
                    DemolistRelaDoc."Belegzeilennr." := 11111
                  ELSE
                    DemolistRelaDoc."Belegzeilennr." := PrfeDemolistRelaDoc."Belegzeilennr." + 11111;

                  DemolistRelaDoc."Debitornr." := SalesLine."Sell-to Customer No.";
                  DemolistRelaDoc."SUP Artikelnr." := SalesLine."No.";
                  DemolistRelaDoc."Ger„te Artikelnr." := Opt_License."Nr.";
                  DemolistRelaDoc."Menge kalk." := Opt_License.Werte;
                  DemolistRelaDoc.Fremderwerb := TRUE;
                  DemolistRelaDoc.INSERT(TRUE);
                UNTIL Opt_License.NEXT = 0;
            END;
        END;
    END;

    PROCEDURE NeueDemoPos@1140018();
    VAR
      DemolistRelaDoc@1140001 : Record 50027;
      PrfeDemolistRelaDoc@1140002 : Record 50027;
    BEGIN
      //Splicecom Funktion
      IF Rec.HASFILTER THEN
        BEGIN
          EVALUATE(zeilennr,GETFILTER("Zeilennr."));

          SalesLine.RESET;
          SalesLine.SETFILTER("Document No.",'%1',GETFILTER("Nr."));
          SalesLine.SETFILTER("Line No.",'%1',zeilennr);
          IF SalesLine.FINDFIRST THEN
            BEGIN
              DemolistRelaDoc.INIT;
              DemolistRelaDoc.Art := Art :: "SPL-AU";
              DemolistRelaDoc."Nr." := SalesLine."Document No.";
              DemolistRelaDoc."Zeilennr." := zeilennr;
              DemolistRelaDoc."Belegnr." := SalesLine."Document No.";
              PrfeDemolistRelaDoc.RESET;
              PrfeDemolistRelaDoc.SETFILTER(Art,'%1',DemolistRelaDoc.Art);
              PrfeDemolistRelaDoc.SETFILTER("Nr.",'%1',SalesLine."Document No.");
              PrfeDemolistRelaDoc.SETFILTER("Zeilennr.",'%1',DemolistRelaDoc."Zeilennr.");
              IF NOT PrfeDemolistRelaDoc.FINDLAST THEN
                DemolistRelaDoc."Belegzeilennr." := 11111
              ELSE
                DemolistRelaDoc."Belegzeilennr." := PrfeDemolistRelaDoc."Belegzeilennr." + 11111;
              DemolistRelaDoc."Debitornr." := SalesLine."Sell-to Customer No.";
              DemolistRelaDoc."SUP Artikelnr." := SalesLine."No.";
              DemolistRelaDoc.Fremderwerb := TRUE;
              DemolistRelaDoc.INSERT(TRUE);
            END;
        END;
    END;

    PROCEDURE Pruefung_ignorieren@1140017(Service_Artikelnr@1140000 : Code[20];Ger„te_Artikelnr@1140001 : Code[20];Basis@1140004 : Boolean) : Boolean;
    VAR
      Service_Artikel@1140002 : Record 27;
      Ger„te_Artikel@1140003 : Record 27;
    BEGIN
      Ger„te_Artikel.GET(Ger„te_Artikelnr);
      Service_Artikel.GET(Service_Artikelnr);

      IF (Basis = TRUE) AND ((Service_Artikel.Artikelgruppe = 'CHAMPS') OR (Service_Artikel.Artikelgruppe = 'CHAMPS_PARTNER')
      OR (Service_Artikel.Artikelgruppe = 'ACHAT') OR (Service_Artikel.Artikelgruppe = 'ACTS')
      OR (Service_Artikel.Artikelgruppe = 'ACTS_MSS') OR (Service_Artikel.Artikelgruppe = 'ACTS/ACHAT')
      OR (Service_Artikel.Artikelgruppe = 'APSS_OB') OR (Service_Artikel.Artikelgruppe = 'CHAMPS_FEE')
      OR (Service_Artikel.Artikelgruppe = 'ACTS_SCHAEFFLER') OR (Service_Artikel.Artikelgruppe = 'ACTS_MSS_SCHAEFFLER'))
      AND (Ger„te_Artikel.Serviceklassifizierung <> 'SYSTEM FLAT') THEN
        EXIT(FALSE)
      ELSE
        EXIT(TRUE);
    END;

    EVENT Sheet@1140019::SelectionChange@1543(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Sheet@1140019::BeforeDoubleClick@1537(Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Sheet@1140019::BeforeRightClick@1534(Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Sheet@1140019::Activate@304();
    BEGIN
    END;

    EVENT Sheet@1140019::Deactivate@1530();
    BEGIN
    END;

    EVENT Sheet@1140019::Calculate@279();
    BEGIN
    END;

    EVENT Sheet@1140019::Change@1545(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Sheet@1140019::FollowHyperlink@1470(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00024431-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Hyperlink");
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableUpdate@2156(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableAfterValueChange@2886(TargetPivotTable@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";TargetRange@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableBeforeAllocateChange@2889(TargetPivotTable@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";ValueChangeStart@1140002 : Integer;ValueChangeEnd@1140001 : Integer;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableBeforeCommitChanges@2892(TargetPivotTable@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";ValueChangeStart@1140002 : Integer;ValueChangeEnd@1140001 : Integer;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableBeforeDiscardChanges@2893(TargetPivotTable@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";ValueChangeStart@1140001 : Integer;ValueChangeEnd@1140000 : Integer);
    BEGIN
    END;

    EVENT Sheet@1140019::PivotTableChangeSync@2894(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Book@1140021::Open@1923();
    BEGIN
    END;

    EVENT Book@1140021::Activate@304();
    BEGIN
    END;

    EVENT Book@1140021::Deactivate@1530();
    BEGIN
    END;

    EVENT Book@1140021::BeforeClose@1546(VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::BeforeSave@1547(SaveAsUI@1140001 : Boolean;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::BeforePrint@1549(VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::NewSheet@1550(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Book@1140021::AddinInstall@1552();
    BEGIN
    END;

    EVENT Book@1140021::AddinUninstall@1553();
    BEGIN
    END;

    EVENT Book@1140021::WindowResize@1554(Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Book@1140021::WindowActivate@1556(Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Book@1140021::WindowDeactivate@1557(Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Book@1140021::SheetSelectionChange@1558(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Book@1140021::SheetBeforeDoubleClick@1559(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::SheetBeforeRightClick@1560(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::SheetActivate@1561(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Book@1140021::SheetDeactivate@1562(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Book@1140021::SheetCalculate@1563(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Book@1140021::SheetChange@1564(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Book@1140021::SheetFollowHyperlink@1854(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00024431-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Hyperlink");
    BEGIN
    END;

    EVENT Book@1140021::SheetPivotTableUpdate@2157(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Book@1140021::PivotTableCloseConnection@2158(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Book@1140021::PivotTableOpenConnection@2159(Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Book@1140021::Sync@2266(SyncEventType@1140000 : Integer);
    BEGIN
    END;

    EVENT Book@1140021::BeforeXmlImport@2283(Map@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140002 : Text[1024];IsRefresh@1140001 : Boolean;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::AfterXmlImport@2285(Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";IsRefresh@1140001 : Boolean;Result@1140000 : Integer);
    BEGIN
    END;

    EVENT Book@1140021::BeforeXmlExport@2287(Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140001 : Text[1024];VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::AfterXmlExport@2288(Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140001 : Text[1024];Result@1140000 : Integer);
    BEGIN
    END;

    EVENT Book@1140021::RowsetComplete@2610(Description@1140002 : Text[1024];Sheet@1140001 : Text[1024];Success@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::SheetPivotTableAfterValueChang@2895(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";TargetPivotTable@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";TargetRange@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Book@1140021::SheetPivotTableBeforeAllocateC@2896(Sh@1140004 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";TargetPivotTable@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";ValueChangeStart@1140002 : Integer;ValueChangeEnd@1140001 : Integer;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::SheetPivotTableChangeSync@2899(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Book@1140021::AfterSave@2900(Success@1140000 : Boolean);
    BEGIN
    END;

    EVENT Book@1140021::NewChart@2901(Ch@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020821-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Chart");
    BEGIN
    END;

    EVENT Excel@1140022::NewWorkbook@1565(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::SheetSelectionChange@1558(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Excel@1140022::SheetBeforeDoubleClick@1559(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::SheetBeforeRightClick@1560(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::SheetActivate@1561(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Excel@1140022::SheetDeactivate@1562(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Excel@1140022::SheetCalculate@1563(Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Excel@1140022::SheetChange@1564(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookOpen@1567(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookActivate@1568(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookDeactivate@1569(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookBeforeClose@1570(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookBeforeSave@1571(Wb@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";SaveAsUI@1140001 : Boolean;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookBeforePrint@1572(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookNewSheet@1573(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Sh@1140000 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookAddinInstall@1574(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookAddinUninstall@1575(Wb@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook");
    BEGIN
    END;

    EVENT Excel@1140022::WindowResize@1554(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Excel@1140022::WindowActivate@1556(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Excel@1140022::WindowDeactivate@1557(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Wn@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020893-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Window");
    BEGIN
    END;

    EVENT Excel@1140022::SheetFollowHyperlink@1854(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00024431-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Hyperlink");
    BEGIN
    END;

    EVENT Excel@1140022::SheetPivotTableUpdate@2157(Sh@1140001 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookPivotTableCloseConnect@2160(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookPivotTableOpenConnecti@2161(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Target@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookSync@2289(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";SyncEventType@1140000 : Integer);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookBeforeXmlImport@2290(Wb@1140004 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Map@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140002 : Text[1024];IsRefresh@1140001 : Boolean;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookAfterXmlImport@2291(Wb@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";IsRefresh@1140001 : Boolean;Result@1140000 : Integer);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookBeforeXmlExport@2292(Wb@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140001 : Text[1024];VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookAfterXmlExport@2293(Wb@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Map@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{0002447B-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.XmlMap";Url@1140001 : Text[1024];Result@1140000 : Integer);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookRowsetComplete@2611(Wb@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Description@1140002 : Text[1024];Sheet@1140001 : Text[1024];Success@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::AfterCalculate@2612();
    BEGIN
    END;

    EVENT Excel@1140022::SheetPivotTableAfterValueChang@2895(Sh@1140002 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";TargetPivotTable@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";TargetRange@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020846-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Range");
    BEGIN
    END;

    EVENT Excel@1140022::SheetPivotTableBeforeAllocateC@2896(Sh@1140004 : Automation ":{00020400-0000-0000-C000-000000000046}:''.IDISPATCH";TargetPivotTable@1140003 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020872-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.PivotTable";ValueChangeStart@1140002 : Integer;ValueChangeEnd@1140001 : Integer;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::ProtectedViewWindowOpen@2903(Pvw@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{000244CD-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.ProtectedViewWindow");
    BEGIN
    END;

    EVENT Excel@1140022::ProtectedViewWindowBeforeClose@2906(Pvw@1140002 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{000244CD-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.ProtectedViewWindow";Reason@1140001 : Integer;VAR Cancel@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::ProtectedViewWindowResize@2908(Pvw@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{000244CD-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.ProtectedViewWindow");
    BEGIN
    END;

    EVENT Excel@1140022::ProtectedViewWindowActivate@2909(Pvw@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{000244CD-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.ProtectedViewWindow");
    BEGIN
    END;

    EVENT Excel@1140022::ProtectedViewWindowDeactivate@2910(Pvw@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{000244CD-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.ProtectedViewWindow");
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookAfterSave@2911(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Success@1140000 : Boolean);
    BEGIN
    END;

    EVENT Excel@1140022::WorkbookNewChart@2912(Wb@1140001 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020819-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Workbook";Ch@1140000 : Automation "{00020813-0000-0000-C000-000000000046} 1.7:{00020821-0000-0000-C000-000000000046}:'Microsoft Excel 14.0 Object Library'.Chart");
    BEGIN
    END;

    BEGIN
    {
      # 2013-10-21 ST Splicecom Demo / Lizenz Anbindung
    }
    END.
  }
}

